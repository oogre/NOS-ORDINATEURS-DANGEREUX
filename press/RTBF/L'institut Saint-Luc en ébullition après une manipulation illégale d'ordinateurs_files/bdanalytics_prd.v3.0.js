/*! For license information please see bdanalytics_prd.v3.0.js.LICENSE */
/* uglified */
!function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var r={};t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=29)}([function(e,t,r){"use strict";var n=e.exports.Validator=r(31);e.exports.ValidatorResult=r(2).ValidatorResult,e.exports.ValidationError=r(2).ValidationError,e.exports.SchemaError=r(2).SchemaError,e.exports.SchemaScanResult=r(10).SchemaScanResult,e.exports.scan=r(10).scan,e.exports.validate=function(e,t,r){return(new n).validate(e,t,r)}},function(e,t){var r={id:"/PlayerAction",$schema:"http://json-schema.org/draft-07/schema#",type:"object",required:["id","mediatype","action","oldstate","newstate","reason","currentTime","totalTime"],additionalProperties:!1,properties:{id:{type:"number"},mediatype:{type:"string"},action:{type:"string"},oldstate:{type:"string"},newstate:{type:"string"},reason:{type:"string"},currentTime:{type:"number"},totalTime:{type:"number"}}},n={id:"/ChangeVisibleAction",$schema:"http://json-schema.org/draft-07/schema#",type:"object",required:["action","tags"],additionalProperties:!1,minProperties:2,maxProperties:2,properties:{action:{type:"string",enum:["BLUR","FOCUS"]},tags:{type:"array",items:{type:"object",minProperties:1,maxProperties:1}}}},o={id:"/ViewedData",$schema:"http://json-schema.org/draft-07/schema#",type:"object",required:["user","media","partnerKey","queryId","layout"],additionalProperties:!1,minProperties:1,properties:{user:{$ref:"/User"},media:{$ref:"/Media"},partnerKey:{type:"string"},queryId:{type:"string"},layout:{type:"string"}}},i={id:"/Feedback",$schema:"http://json-schema.org/draft-07/schema#",type:"object",required:["action","eventObj","user"],additionalProperties:!1,minProperties:1,properties:{action:{type:"string"},eventObj:{type:"object"},user:{$ref:"/User"}}},a={id:"FeedbackContructorData",$schema:"http://json-schema.org/draft-07/schema#",type:"object",required:["action","user"],additionalProperties:!1,minProperties:1,properties:{action:{type:"string"},user:{$ref:"/User"}}},s={id:"/Media",$schema:"http://json-schema.org/draft-07/schema#",type:"object",required:["mediaId","mediaType"],additionalProperties:!1,minProperties:1,properties:{mediaId:{type:["string","number"]},mediaType:{type:"string"}}},u={id:"/PlayerAction",$schema:"http://json-schema.org/draft-07/schema#",type:"object",required:["action","id","mediatype"],additionalProperties:!1,properties:{action:{type:"string"},id:{type:"number"},mediatype:{type:"string"},currentTime:{type:"number"},totalTime:{type:"number"},seekTo:{type:"number"},tag:{type:"object"}}},c={id:"/RecoConstructorData",$schema:"http://json-schema.org/draft-07/schema#",type:"object",required:["user","media","excludeConsumedContent","limit","layout","recoType"],additionalProperties:!1,minProperties:1,properties:{user:{$ref:"/User"},media:{$ref:"/Media"},partnerKey:{type:"string"},excludeConsumedContent:{type:"string"},excludeProgramId:{type:"array",items:{type:"string"}},includeProgramId:{type:"array",items:{type:"string"}},includeMediaType:{type:"array",items:{type:"string"}},includeCategoryIds:{type:"array",items:{type:"string"}},includeContentType:{type:"array",items:{type:"string"}},location:{type:"string",enum:["belgium","europe","world"]},limit:{type:"number"},layout:{type:"string"},recoType:{type:"string",enum:["u2c","c2c","c2c_v2"]}}},l={id:"/RecommendationSendData",$schema:"http://json-schema.org/draft-07/schema#",type:"object",required:["media","excludeConsumedContent","limit","location","layout","recoType"],additionalProperties:!1,minProperties:1,properties:{media:{$ref:"/Media"},excludeConsumedContent:{type:"string"},excludeProgramId:{type:"array",items:{type:"string"}},includeProgramId:{type:"array",items:{type:"string"}},includeMediaType:{type:"array",items:{type:"string"}},includeCategoryIds:{type:"array",items:{type:"string"}},includeContentType:{type:"array",items:{type:"string"}},limit:{type:"number"},location:{type:"string",enum:["belgium","europe","world"]},layout:{type:"string"},recoType:{type:"string",enum:["u2c","c2c","c2c_v2"]}}},f={id:"/RecommendationConstrutorData",$schema:"http://json-schema.org/draft-07/schema#",type:"object",required:["user"],additionalProperties:!1,minProperties:1,properties:{user:{$ref:"/User"}}},h={id:"/RecommendationSendData",$schema:"http://json-schema.org/draft-07/schema#",type:"object",required:["excludeConsumedContent","limit","layout","recoType"],additionalProperties:!1,minProperties:1,properties:{media:{$ref:"/Media"},excludeConsumedContent:{type:"string"},excludeProgramId:{type:"array",items:{type:"string"}},includeProgramId:{type:"array",items:{type:"string"}},includeMediaType:{type:"array",items:{type:"string"}},includeCategoryIds:{type:"array",items:{type:"string"}},includeContentType:{type:"array",items:{type:"string"}},limit:{type:"number"},location:{type:"string",enum:["belgium","europe","world"]},layout:{type:"string"},recoType:{type:"string",enum:["u2c","c2c","c2c_v2"]}}},p={id:"/TrackerModule",$schema:"http://json-schema.org/draft-07/schema#",type:"object",required:["screen","articleTag"],additionalProperties:!1,minProperties:1,properties:{screen:{type:"object"},articleTag:{minLength:3,type:"string"}}},d={id:"/User",$schema:"http://json-schema.org/draft-07/schema#",type:"object",required:["userId","sessionId","userAge"],additionalProperties:!1,minProperties:1,properties:{userId:{type:"string"},sessionId:{type:"string"},userAge:{type:"number"}}},y={id:"/UserChangeAction",$schema:"http://json-schema.org/draft-07/schema#",type:"object",required:["uid","sid","userChangeAction"],additionalProperties:!1,properties:{uid:{type:"string"},sid:{type:"string"},userChangeAction:{type:"string",enum:["connected","autoConnected","disconnected"]}}},m={id:"/ViewedRelatedConstructorData",$schema:"http://json-schema.org/draft-07/schema#",type:"object",required:["data","feedback"],additionalProperties:!1,minProperties:1,properties:{data:{type:"object",required:["layout"],additionalProperties:!1,properties:{layout:{type:"string"}}},feedback:{$ref:"/Feedback"}}},v={id:"/ViewedScrollConstructorData",$schema:"http://json-schema.org/draft-07/schema#",type:"object",required:["data","feedback"],additionalProperties:!1,minProperties:1,properties:{data:{type:"object",required:["selector","layout","queryId"],additionalProperties:!1,properties:{selector:{type:"string"},layout:{type:"string"},queryId:{type:"string"}}},feedback:{$ref:"/Feedback"}}},g={id:"/ViewedRelatedOpenData",$schema:"http://json-schema.org/draft-07/schema#",type:"object",required:["medias","queryId","method"],additionalProperties:!1,minProperties:1,properties:{medias:{type:"array",items:{type:"object",$ref:"/Media"}},queryId:{type:"string"},method:{type:"string"}}},b={id:"/ViewedData",$schema:"http://json-schema.org/draft-07/schema#",type:"object",required:["layout","feedback"],additionalProperties:!1,minProperties:1,properties:{layout:{type:"string"},feedback:{$ref:"/Feedback"}}};e.exports={BufferActionSchema:r,ChangeVisibilityActionSchema:n,ClickConstructorDataSchema:o,FeedbackSchema:i,FeedbackConstructorDataSchema:a,MediaSchema:s,PlayerActionSchema:u,RecoConstructorDataSchema:c,RecoSendDataSchema:l,RecommendationConstructorDataSchema:f,RecommendationSendDataSchema:h,TrackerModuleSchema:p,UserSchema:d,UserChangeActionSchema:y,ViewedDataSchema:b,ViewedRelatedConstructorDataSchema:m,ViewedRelatedOpenDataSchema:g,ViewedScrollConstructorDataSchema:v}},function(e,t,r){"use strict";function n(e,t){return t+": "+e.toString()+"\n"}function o(e,t,r,n){"object"==typeof r?t[n]=s(e[n],r):-1===e.indexOf(r)&&t.push(r)}function i(e,t,r){t[r]=e[r]}function a(e,t,r,n){"object"==typeof t[n]&&t[n]&&e[n]?r[n]=s(e[n],t[n]):r[n]=t[n]}function s(e,t){var r=Array.isArray(t),n=r&&[]||{};return r?(e=e||[],n=n.concat(e),t.forEach(o.bind(null,e,n))):(e&&"object"==typeof e&&Object.keys(e).forEach(i.bind(null,e,n)),Object.keys(t).forEach(a.bind(null,e,t,n))),n}function u(e){return"/"+encodeURIComponent(e).replace(/~/g,"%7E")}var c=r(9),l=t.ValidationError=function(e,t,r,n,o,i){n&&(this.property=n),e&&(this.message=e),r&&(r.id?this.schema=r.id:this.schema=r),t&&(this.instance=t),this.name=o,this.argument=i,this.stack=this.toString()};l.prototype.toString=function(){return this.property+" "+this.message};var f=t.ValidatorResult=function(e,t,r,n){this.instance=e,this.schema=t,this.propertyPath=n.propertyPath,this.errors=[],this.throwError=r&&r.throwError,this.disableFormat=r&&!0===r.disableFormat};f.prototype.addError=function(e){var t;if("string"==typeof e)t=new l(e,this.instance,this.schema,this.propertyPath);else{if(!e)throw new Error("Missing error detail");if(!e.message)throw new Error("Missing error message");if(!e.name)throw new Error("Missing validator type");t=new l(e.message,this.instance,this.schema,this.propertyPath,e.name,e.argument)}if(this.throwError)throw t;return this.errors.push(t),t},f.prototype.importErrors=function(e){"string"==typeof e||e&&e.validatorType?this.addError(e):e&&e.errors&&Array.prototype.push.apply(this.errors,e.errors)},f.prototype.toString=function(e){return this.errors.map(n).join("")},Object.defineProperty(f.prototype,"valid",{get:function(){return!this.errors.length}});var h=t.SchemaError=function e(t,r){this.message=t,this.schema=r,Error.call(this,t),Error.captureStackTrace(this,e)};h.prototype=Object.create(Error.prototype,{constructor:{value:h,enumerable:!1},name:{value:"SchemaError",enumerable:!1}});var p=t.SchemaContext=function(e,t,r,n,o){this.schema=e,this.options=t,this.propertyPath=r,this.base=n,this.schemas=o};p.prototype.resolve=function(e){return c.resolve(this.base,e)},p.prototype.makeChild=function(e,t){var r=void 0===t?this.propertyPath:this.propertyPath+y(t),n=c.resolve(this.base,e.id||""),o=new p(e,this.options,r,n,Object.create(this.schemas));return e.id&&!o.schemas[n]&&(o.schemas[n]=e),o};var d=t.FORMAT_REGEXPS={"date-time":/^\d{4}-(?:0[0-9]{1}|1[0-2]{1})-(3[01]|0[1-9]|[12][0-9])[tT ](2[0-4]|[01][0-9]):([0-5][0-9]):(60|[0-5][0-9])(\.\d+)?([zZ]|[+-]([0-5][0-9]):(60|[0-5][0-9]))$/,date:/^\d{4}-(?:0[0-9]{1}|1[0-2]{1})-(3[01]|0[1-9]|[12][0-9])$/,time:/^(2[0-4]|[01][0-9]):([0-5][0-9]):(60|[0-5][0-9])$/,email:/^(?:[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+\.)*[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+@(?:(?:(?:[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!\.)){0,61}[a-zA-Z0-9]?\.)+[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!$)){0,61}[a-zA-Z0-9]?)|(?:\[(?:(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\.){3}(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\]))$/,"ip-address":/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,ipv6:/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,uri:/^[a-zA-Z][a-zA-Z0-9+-.]*:[^\s]*$/,color:/^(#?([0-9A-Fa-f]{3}){1,2}\b|aqua|black|blue|fuchsia|gray|green|lime|maroon|navy|olive|orange|purple|red|silver|teal|white|yellow|(rgb\(\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*,\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*,\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*\))|(rgb\(\s*(\d?\d%|100%)+\s*,\s*(\d?\d%|100%)+\s*,\s*(\d?\d%|100%)+\s*\)))$/,hostname:/^(?=.{1,255}$)[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?(?:\.[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?)*\.?$/,"host-name":/^(?=.{1,255}$)[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?(?:\.[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?)*\.?$/,alpha:/^[a-zA-Z]+$/,alphanumeric:/^[a-zA-Z0-9]+$/,"utc-millisec":function(e){return"string"==typeof e&&parseFloat(e)===parseInt(e,10)&&!isNaN(e)},regex:function(e){var t=!0;try{new RegExp(e)}catch(e){t=!1}return t},style:/\s*(.+?):\s*([^;]+);?/g,phone:/^\+(?:[0-9] ?){6,14}[0-9]$/};d.regexp=d.regex,d.pattern=d.regex,d.ipv4=d["ip-address"],t.isFormat=function(e,t,r){if("string"==typeof e&&void 0!==d[t]){if(d[t]instanceof RegExp)return d[t].test(e);if("function"==typeof d[t])return d[t](e)}else if(r&&r.customFormats&&"function"==typeof r.customFormats[t])return r.customFormats[t](e);return!0};var y=t.makeSuffix=function(e){return e=e.toString(),e.match(/[.\s\[\]]/)||e.match(/^[\d]/)?e.match(/^\d+$/)?"["+e+"]":"["+JSON.stringify(e)+"]":"."+e};t.deepCompareStrict=function e(t,r){if(typeof t!=typeof r)return!1;if(t instanceof Array)return r instanceof Array&&t.length===r.length&&t.every(function(n,o){return e(t[o],r[o])});if("object"==typeof t){if(!t||!r)return t===r;var n=Object.keys(t),o=Object.keys(r);return n.length===o.length&&n.every(function(n){return e(t[n],r[n])})}return t===r},e.exports.deepMerge=s,t.objectGetPath=function(e,t){for(var r,n=t.split("/").slice(1);"string"==typeof(r=n.shift());){var o=decodeURIComponent(r.replace(/~0/,"~").replace(/~1/g,"/"));if(!(o in e))return;e=e[o]}return e},t.encodePath=function(e){return e.map(u).join("")},t.getDecimalPlaces=function(e){var t=0;if(isNaN(e))return t;"number"!=typeof e&&(e=Number(e));var r=e.toString().split("e");if(2===r.length){if("-"!==r[1][0])return t;t=Number(r[1].slice(1))}var n=r[0].split(".");return 2===n.length&&(t+=n[1].length),t}},function(e,t){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?i(e):t}function i(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}function s(e){var t="function"==typeof Map?new Map:void 0;return(s=function(e){function r(){return c(e,arguments,h(this).constructor)}if(null===e||!l(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),f(r,e)})(e)}function u(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function c(e,t,r){return c=u()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var o=Function.bind.apply(e,n),i=new o;return r&&f(i,r.prototype),i},c.apply(null,arguments)}function l(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var p=function(e){function t(e,r){var i;return n(this,t),i=o(this,h(t).call(this,"".concat(e," is not a ").concat(r))),i.name=i.constructor.name,i}return a(t,e),t}(s(Error)),d=function(e){function t(e){var r;return n(this,t),r=o(this,h(t).call(this,"All the element in the array should to be as ".concat(e))),r.name=r.constructor.name,r}return a(t,e),t}(s(Error)),y=function(e){function t(e,r){var i;return n(this,t),i=o(this,h(t).call(this,"".concat(e," is not an instance of ").concat(r))),i.name=i.constructor.name,i}return a(t,e),t}(s(Error)),m=function(e){function t(e){var r;return n(this,t),r=o(this,h(t).call(this,"The field: ".concat(e,", is missing"))),r.name=r.constructor.name,r}return a(t,e),t}(s(Error));e.exports={TypeError:p,InternalArrayTypeError:d,InstanceTypeError:y,MissingFieldError:m}},function(e,t,r){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),e}var a=r(0).Validator,s=r(1),u=s.UserSchema,c=function(){function e(t){if(n(this,e),!t)throw new Error("data should be an object");var r=new a,o=r.validate(t,u);if(!o.valid)throw new Error(o.errors);this.setUserId(t.userId),this.setSessionId(t.sessionId),this.setUserAge(t.userAge)}return i(e,[{key:"setUserId",value:function(e){if("string"!=typeof e)throw new Error("userId should be a string");this.userId=e}},{key:"setSessionId",value:function(e){if("string"!=typeof e)throw new Error("sessionId should be a string");this.sessionId=e}},{key:"setUserAge",value:function(e){if("number"!=typeof e)throw new Error("userAge should be a number");this.userAge=e}},{key:"setParams",value:function(e){var t=e.userId,r=e.sessionId,n=e.userAge;t&&(this.userId=t),r&&(this.sessionId=r),n&&(this.userAge=n)}},{key:"getUserId",value:function(){return this.userId}},{key:"getSessionId",value:function(){return this.sessionId}},{key:"getUserAge",value:function(){return this.userAge}},{key:"getUser",value:function(){return{userId:this.getUserId(),sessionId:this.getSessionId(),userAge:this.getUserAge()}}},{key:"toArray",value:function(){return[{key:"userId",value:this.getUserId()},{key:"sessionId",value:this.getSessionId()},{key:"userAge",value:this.getUserAge()}]}},{key:"format",value:function(){return{userId:this.getUserId(),sessionId:this.getSessionId(),userAge:this.getUserAge()}}}]),e}();e.exports=c},function(e,t){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),e}var a=function(){function e(t){n(this,e),this.init(t)}return i(e,[{key:"init",value:function(e){if(!e||"object"!==r(e)||Array.isArray(e))throw new Error("data should be an object");if(!e.hasOwnProperty("mediaId")||!e.hasOwnProperty("mediaType"))throw new Error("mediaId and mediaType shoud be present");this.setMediaId(e.mediaId),this.setMediaType(e.mediaType)}},{key:"setMediaId",value:function(e){if(!e||isNaN(e))throw new Error("mediaId should be a number");this.mediaId=e}},{key:"setMediaType",value:function(e){if(!e||"string"!=typeof e)throw new Error("mediaType should be a string");this.mediaType=e}},{key:"getMediaId",value:function(){return this.mediaId}},{key:"getMediaType",value:function(){return this.mediaType}},{key:"toArray",value:function(){var e=this.getMediaId(),t=this.getMediaType();return e&&t?[{key:"mediaId",value:this.getMediaId().toString()},{key:"mediaType",value:this.getMediaType()}]:[]}}]),e}();e.exports=a},function(e,t){function r(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},o=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),o.forEach(function(t){n(e,t,r[t])})}return e}function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}var s=function(){function e(){o(this,e),this.eventObj={}}return a(e,[{key:"emit",value:function(e,t){if(!e||"string"!=typeof e)throw new Error("name should to be a string");if(!this.eventObj[e])throw new Error("event: ".concat(e,", not exist: ").concat(t&&t.toString&&t.toString()));return this.eventObj[e].forEach(function(e){return e(t)}),this}},{key:"on",value:function(e,t){if(!e||"string"!=typeof e)throw new Error("name should to be a string");if("function"!=typeof t)throw new Error("cb should to be a function");return this.eventObj.hasOwnProperty(e)?this.eventObj[e].push(function(e){return t(e)}):this.eventObj=r({},this.eventObj,n({},e,[function(e){return t(e)}])),this}}]),e}();e.exports=s},function(e,t,r){var n,o=r(3),i=o.TypeError,a=function(e){n=e},s=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(e){return t.reduce(function(e,t){return t(e)},e)}},u=function(e){return function(t){if(t.filter(function(e){return!e.hasOwnProperty("key")||!e.hasOwnProperty("value")}).length>0)throw new Error("The field valid should contains tuple with {key: xxx, value: xxx}");var r=t.reduce(function(e,t){return e[t.key]=t.value,e},{}),n=Object.keys(e).filter(function(t){return e[t]&&!r[t]});if(n.length>0){var o=n.reduce(function(e,t){return"".concat(e,", ").concat(t)},"").replace(/^, /,"");return{error:[new Error("Required fields: ".concat(o,", missing"))],valid:[]}}return t.map(function(t){var r=t.key,n=t.value;switch(!0){case e[r]&&!n:return{error:new Error("field '".concat(r,"' missing")),success:null};case e[r]&&!0===Array.isArray(e[r]):return n.reduce(function(t,n){return t&&n instanceof e[r][0]},!0)?{error:null,success:{key:r,value:n}}:{error:new Error("field: ".concat(r,", haven't the correct instance")),success:null};case e[r]&&!1===Array.isArray(e[r])&&"boolean"!=typeof e[r]&&!(n instanceof e[r]):return{error:new i(r,e[r].name),success:null};case!e.hasOwnProperty(r):return{error:new Error("field ".concat(r," not a valid field")),success:null};default:return{error:null,success:{key:r,value:n}}}}).reduce(function(e,t){var r=t.error,n=t.success;if(r&&r instanceof Error)e.error.push(r);else{if(!n.value)return e;e.valid.push(n)}return e},{error:[],valid:[]})}},c=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!e.hasOwnProperty("error"))throw new Error("Field error is missing");if(!e.hasOwnProperty("valid"))throw new Error("Field valid is missing");if(!Array.isArray(e.error))throw new Error("Field error is not an array");if(!Array.isArray(e.valid))throw new Error("Field valid is not an array");if(e.error.filter(function(e){return!(e instanceof Error)}).length>0)throw new Error("Field error should contain only Error object");if(e.error.length>0)throw new Error(e.error.reduce(function(e,t){var r=t.message;return"".concat(e,", ").concat(r)},"").replace(/^, /,""));if(e.valid.filter(function(e){return!e.hasOwnProperty("key")||!e.hasOwnProperty("value")}).length>0)throw new Error("The field valid should contains tuple with {key: xxx, value: xxx}");return e.valid.reduce(function(e,t){var r=t.key,o=t.value,i=n?r:r.replace(/\.?([A-Z])/g,function(e,t){return"_"+t.toLowerCase()}).replace(/^_/,""),a=Array.isArray(o)?o.reduce(function(e,t){return"".concat(e,"&").concat(i,"[]=").concat(t)},""):"&".concat(i,"=").concat(o);return"".concat(e).concat(a)},"").replace(/^&/,"?")};e.exports={pipe:s,validData:u,buildSearchFromData:c,setUtilRegression:a}},function(e,t){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){"use strict";function n(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}function o(e,t,r){if(e&&c.isObject(e)&&e instanceof n)return e;var o=new n;return o.parse(e,t,r),o}function i(e){return c.isString(e)&&(e=o(e)),e instanceof n?e.format():n.prototype.format.call(e)}function a(e,t){return o(e,!1,!0).resolve(t)}function s(e,t){return e?o(e,!1,!0).resolveObject(t):t}var u=r(32),c=r(33);t.parse=o,t.resolve=a,t.resolveObject=s,t.format=i,t.Url=n;var l=/^([a-z0-9.+-]+:)/i,f=/:[0-9]*$/,h=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,p=["<",">",'"',"`"," ","\r","\n","\t"],d=["{","}","|","\\","^","`"].concat(p),y=["'"].concat(d),m=["%","/","?",";","#"].concat(y),v=["/","?","#"],g=/^[+a-z0-9A-Z_-]{0,63}$/,b=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,w={javascript:!0,"javascript:":!0},E={javascript:!0,"javascript:":!0},_={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},S=r(34);n.prototype.parse=function(e,t,r){if(!c.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var n=e.indexOf("?"),o=-1!==n&&n<e.indexOf("#")?"?":"#",i=e.split(o),a=/\\/g;i[0]=i[0].replace(a,"/"),e=i.join(o);var s=e;if(s=s.trim(),!r&&1===e.split("#").length){var f=h.exec(s);if(f)return this.path=s,this.href=s,this.pathname=f[1],f[2]?(this.search=f[2],this.query=t?S.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var p=l.exec(s);if(p){p=p[0];var d=p.toLowerCase();this.protocol=d,s=s.substr(p.length)}if(r||p||s.match(/^\/\/[^@\/]+@[^@\/]+/)){var T="//"===s.substr(0,2);!T||p&&E[p]||(s=s.substr(2),this.slashes=!0)}if(!E[p]&&(T||p&&!_[p])){for(var O=-1,A=0;A<v.length;A++){var k=s.indexOf(v[A]);-1!==k&&(-1===O||k<O)&&(O=k)}var j,P;P=-1===O?s.lastIndexOf("@"):s.lastIndexOf("@",O),-1!==P&&(j=s.slice(0,P),s=s.slice(P+1),this.auth=decodeURIComponent(j)),O=-1;for(var A=0;A<m.length;A++){var k=s.indexOf(m[A]);-1!==k&&(-1===O||k<O)&&(O=k)}-1===O&&(O=s.length),this.host=s.slice(0,O),s=s.slice(O),this.parseHost(),this.hostname=this.hostname||"";var C="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!C)for(var x=this.hostname.split(/\./),A=0,I=x.length;A<I;A++){var N=x[A];if(N&&!N.match(g)){for(var R="",D=0,M=N.length;D<M;D++)N.charCodeAt(D)>127?R+="x":R+=N[D];if(!R.match(g)){var $=x.slice(0,A),L=x.slice(A+1),U=N.match(b);U&&($.push(U[1]),L.unshift(U[2])),L.length&&(s="/"+L.join(".")+s),this.hostname=$.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),C||(this.hostname=u.toASCII(this.hostname));var F=this.port?":"+this.port:"",q=this.hostname||"";this.host=q+F,this.href+=this.host,C&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==s[0]&&(s="/"+s))}if(!w[d])for(var A=0,I=y.length;A<I;A++){var B=y[A];if(-1!==s.indexOf(B)){var H=encodeURIComponent(B);H===B&&(H=escape(B)),s=s.split(B).join(H)}}var G=s.indexOf("#");-1!==G&&(this.hash=s.substr(G),s=s.slice(0,G));var V=s.indexOf("?");if(-1!==V?(this.search=s.substr(V),this.query=s.substr(V+1),t&&(this.query=S.parse(this.query)),s=s.slice(0,V)):t&&(this.search="",this.query={}),s&&(this.pathname=s),_[d]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var F=this.pathname||"",K=this.search||"";this.path=F+K}return this.href=this.format(),this},n.prototype.format=function(){var e=this.auth||"";e&&(e=encodeURIComponent(e),e=e.replace(/%3A/i,":"),e+="@");var t=this.protocol||"",r=this.pathname||"",n=this.hash||"",o=!1,i="";this.host?o=e+this.host:this.hostname&&(o=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(o+=":"+this.port)),this.query&&c.isObject(this.query)&&Object.keys(this.query).length&&(i=S.stringify(this.query));var a=this.search||i&&"?"+i||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||_[t])&&!1!==o?(o="//"+(o||""),r&&"/"!==r.charAt(0)&&(r="/"+r)):o||(o=""),n&&"#"!==n.charAt(0)&&(n="#"+n),a&&"?"!==a.charAt(0)&&(a="?"+a),r=r.replace(/[?#]/g,function(e){return encodeURIComponent(e)}),a=a.replace("#","%23"),t+o+r+a+n},n.prototype.resolve=function(e){return this.resolveObject(o(e,!1,!0)).format()},n.prototype.resolveObject=function(e){if(c.isString(e)){var t=new n;t.parse(e,!1,!0),e=t}for(var r=new n,o=Object.keys(this),i=0;i<o.length;i++){var a=o[i];r[a]=this[a]}if(r.hash=e.hash,""===e.href)return r.href=r.format(),r;if(e.slashes&&!e.protocol){for(var s=Object.keys(e),u=0;u<s.length;u++){var l=s[u];"protocol"!==l&&(r[l]=e[l])}return _[r.protocol]&&r.hostname&&!r.pathname&&(r.path=r.pathname="/"),r.href=r.format(),r}if(e.protocol&&e.protocol!==r.protocol){if(!_[e.protocol]){for(var f=Object.keys(e),h=0;h<f.length;h++){var p=f[h];r[p]=e[p]}return r.href=r.format(),r}if(r.protocol=e.protocol,e.host||E[e.protocol])r.pathname=e.pathname;else{for(var d=(e.pathname||"").split("/");d.length&&!(e.host=d.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==d[0]&&d.unshift(""),d.length<2&&d.unshift(""),r.pathname=d.join("/")}if(r.search=e.search,r.query=e.query,r.host=e.host||"",r.auth=e.auth,r.hostname=e.hostname||e.host,r.port=e.port,r.pathname||r.search){var y=r.pathname||"",m=r.search||"";r.path=y+m}return r.slashes=r.slashes||e.slashes,r.href=r.format(),r}var v=r.pathname&&"/"===r.pathname.charAt(0),g=e.host||e.pathname&&"/"===e.pathname.charAt(0),b=g||v||r.host&&e.pathname,w=b,S=r.pathname&&r.pathname.split("/")||[],d=e.pathname&&e.pathname.split("/")||[],T=r.protocol&&!_[r.protocol];if(T&&(r.hostname="",r.port=null,r.host&&(""===S[0]?S[0]=r.host:S.unshift(r.host)),r.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===d[0]?d[0]=e.host:d.unshift(e.host)),e.host=null),b=b&&(""===d[0]||""===S[0])),g)r.host=e.host||""===e.host?e.host:r.host,r.hostname=e.hostname||""===e.hostname?e.hostname:r.hostname,r.search=e.search,r.query=e.query,S=d;else if(d.length)S||(S=[]),S.pop(),S=S.concat(d),r.search=e.search,r.query=e.query;else if(!c.isNullOrUndefined(e.search)){if(T){r.hostname=r.host=S.shift();var O=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@");O&&(r.auth=O.shift(),r.host=r.hostname=O.shift())}return r.search=e.search,r.query=e.query,c.isNull(r.pathname)&&c.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.href=r.format(),r}if(!S.length)return r.pathname=null,r.search?r.path="/"+r.search:r.path=null,r.href=r.format(),r;for(var A=S.slice(-1)[0],k=(r.host||e.host||S.length>1)&&("."===A||".."===A)||""===A,j=0,P=S.length;P>=0;P--)A=S[P],"."===A?S.splice(P,1):".."===A?(S.splice(P,1),j++):j&&(S.splice(P,1),j--);if(!b&&!w)for(;j--;j)S.unshift("..");!b||""===S[0]||S[0]&&"/"===S[0].charAt(0)||S.unshift(""),k&&"/"!==S.join("/").substr(-1)&&S.push("");var C=""===S[0]||S[0]&&"/"===S[0].charAt(0);if(T){r.hostname=r.host=C?"":S.length?S.shift():"";var O=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@");O&&(r.auth=O.shift(),r.host=r.hostname=O.shift())}return b=b||r.host&&S.length,b&&!C&&S.unshift(""),S.length?r.pathname=S.join("/"):(r.pathname=null,r.path=null),c.isNull(r.pathname)&&c.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.auth=e.auth||r.auth,r.slashes=r.slashes||e.slashes,r.href=r.format(),r},n.prototype.parseHost=function(){var e=this.host,t=f.exec(e);t&&(t=t[0],":"!==t&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},function(e,t,r){function n(e,t){this.id=e,this.ref=t}var o=r(9),i=r(2);e.exports.SchemaScanResult=n,e.exports.scan=function(e,t){function r(e,t){if(t&&"object"==typeof t){if(t.$ref){var n=o.resolve(e,t.$ref);return void(c[n]=c[n]?c[n]+1:0)}var l=t.id?o.resolve(e,t.id):e;if(l){if(l.indexOf("#")<0&&(l+="#"),u[l]){if(!i.deepCompareStrict(u[l],t))throw new Error("Schema <"+t+"> already exists with different definition");return u[l]}u[l]=t,"#"==l[l.length-1]&&(u[l.substring(0,l.length-1)]=t)}a(l+"/items",t.items instanceof Array?t.items:[t.items]),a(l+"/extends",t.extends instanceof Array?t.extends:[t.extends]),r(l+"/additionalItems",t.additionalItems),s(l+"/properties",t.properties),r(l+"/additionalProperties",t.additionalProperties),s(l+"/definitions",t.definitions),s(l+"/patternProperties",t.patternProperties),s(l+"/dependencies",t.dependencies),a(l+"/disallow",t.disallow),a(l+"/allOf",t.allOf),a(l+"/anyOf",t.anyOf),a(l+"/oneOf",t.oneOf),r(l+"/not",t.not)}}function a(e,t){if(t instanceof Array)for(var n=0;n<t.length;n++)r(e+"/"+n,t[n])}function s(e,t){if(t&&"object"==typeof t)for(var n in t)r(e+"/"+n,t[n])}var u={},c={};return r(e,t),new n(u,c)}},function(e,t,r){"use strict";var n=r(12);e.exports=n.call(Function.call,Object.prototype.hasOwnProperty)},function(e,t,r){"use strict";var n=r(60);e.exports=Function.prototype.bind||n},function(e,t,r){"use strict";var n=Function.prototype.toString,o=/^\s*class\b/,i=function(e){try{var t=n.call(e);return o.test(t)}catch(e){return!1}},a=function(e){try{return!i(e)&&(n.call(e),!0)}catch(e){return!1}},s=Object.prototype.toString,u="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag;e.exports=function(e){if(!e)return!1;if("function"!=typeof e&&"object"!=typeof e)return!1;if("function"==typeof e&&!e.prototype)return!0;if(u)return a(e);if(i(e))return!1;var t=s.call(e);return"[object Function]"===t||"[object GeneratorFunction]"===t}},function(e,t,r){(function(t,r){!function(r,n){e.exports=function(){"use strict";function e(e){var t=typeof e;return null!==e&&("object"===t||"function"===t)}function n(e){return"function"==typeof e}function o(e){q=e}function i(e){B=e}function a(){return void 0!==F?function(){F(u)}:s()}function s(){var e=setTimeout;return function(){return e(u,1)}}function u(){for(var e=0;e<U;e+=2)(0,X[e])(X[e+1]),X[e]=void 0,X[e+1]=void 0;U=0}function c(e,t){var r=this,n=new this.constructor(f);void 0===n[J]&&P(n);var o=r._state;if(o){var i=arguments[o-1];B(function(){return A(o,n,i,r._result)})}else S(r,n,e,t);return n}function l(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var r=new t(f);return b(r,e),r}function f(){}function h(){return new TypeError("You cannot resolve a promise with itself")}function p(){return new TypeError("A promises callback cannot return that same promise.")}function d(e){try{return e.then}catch(e){return ee.error=e,ee}}function y(e,t,r,n){try{e.call(t,r,n)}catch(e){return e}}function m(e,t,r){B(function(e){var n=!1,o=y(r,t,function(r){n||(n=!0,t!==r?b(e,r):E(e,r))},function(t){n||(n=!0,_(e,t))},"Settle: "+(e._label||" unknown promise"));!n&&o&&(n=!0,_(e,o))},e)}function v(e,t){t._state===Y?E(e,t._result):t._state===Q?_(e,t._result):S(t,void 0,function(t){return b(e,t)},function(t){return _(e,t)})}function g(e,t,r){t.constructor===e.constructor&&r===c&&t.constructor.resolve===l?v(e,t):r===ee?(_(e,ee.error),ee.error=null):void 0===r?E(e,t):n(r)?m(e,t,r):E(e,t)}function b(t,r){t===r?_(t,h()):e(r)?g(t,r,d(r)):E(t,r)}function w(e){e._onerror&&e._onerror(e._result),T(e)}function E(e,t){e._state===Z&&(e._result=t,e._state=Y,0!==e._subscribers.length&&B(T,e))}function _(e,t){e._state===Z&&(e._state=Q,e._result=t,B(w,e))}function S(e,t,r,n){var o=e._subscribers,i=o.length;e._onerror=null,o[i]=t,o[i+Y]=r,o[i+Q]=n,0===i&&e._state&&B(T,e)}function T(e){var t=e._subscribers,r=e._state;if(0!==t.length){for(var n=void 0,o=void 0,i=e._result,a=0;a<t.length;a+=3)n=t[a],o=t[a+r],n?A(r,n,o,i):o(i);e._subscribers.length=0}}function O(e,t){try{return e(t)}catch(e){return ee.error=e,ee}}function A(e,t,r,o){var i=n(r),a=void 0,s=void 0,u=void 0,c=void 0;if(i){if(a=O(r,o),a===ee?(c=!0,s=a.error,a.error=null):u=!0,t===a)return void _(t,p())}else a=o,u=!0;t._state!==Z||(i&&u?b(t,a):c?_(t,s):e===Y?E(t,a):e===Q&&_(t,a))}function k(e,t){try{t(function(t){b(e,t)},function(t){_(e,t)})}catch(t){_(e,t)}}function j(){return te++}function P(e){e[J]=te++,e._state=void 0,e._result=void 0,e._subscribers=[]}function C(){return new Error("Array Methods must be provided an Array")}function x(e){return new re(this,e).promise}function I(e){var t=this;return new t(L(e)?function(r,n){for(var o=e.length,i=0;i<o;i++)t.resolve(e[i]).then(r,n)}:function(e,t){return t(new TypeError("You must pass an array to race."))})}function N(e){var t=this,r=new t(f);return _(r,e),r}function R(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function D(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function M(){var e=void 0;if(void 0!==r)e=r;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var n=null;try{n=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===n&&!t.cast)return}e.Promise=ne}var $=void 0;$=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var L=$,U=0,F=void 0,q=void 0,B=function(e,t){X[U]=e,X[U+1]=t,2===(U+=2)&&(q?q(u):W())},H="undefined"!=typeof window?window:void 0,G=H||{},V=G.MutationObserver||G.WebKitMutationObserver,K="undefined"==typeof self&&void 0!==t&&"[object process]"==={}.toString.call(t),z="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,X=new Array(1e3),W=void 0;W=K?function(){return function(){return t.nextTick(u)}}():V?function(){var e=0,t=new V(u),r=document.createTextNode("");return t.observe(r,{characterData:!0}),function(){r.data=e=++e%2}}():z?function(){var e=new MessageChannel;return e.port1.onmessage=u,function(){return e.port2.postMessage(0)}}():void 0===H?function(){try{var e=Function("return this")().require("vertx");return F=e.runOnLoop||e.runOnContext,a()}catch(e){return s()}}():s();var J=Math.random().toString(36).substring(2),Z=void 0,Y=1,Q=2,ee={error:null},te=0,re=function(){function e(e,t){this._instanceConstructor=e,this.promise=new e(f),this.promise[J]||P(this.promise),L(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?E(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&E(this.promise,this._result))):_(this.promise,C())}return e.prototype._enumerate=function(e){for(var t=0;this._state===Z&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var r=this._instanceConstructor,n=r.resolve;if(n===l){var o=d(e);if(o===c&&e._state!==Z)this._settledAt(e._state,t,e._result);else if("function"!=typeof o)this._remaining--,this._result[t]=e;else if(r===ne){var i=new r(f);g(i,e,o),this._willSettleAt(i,t)}else this._willSettleAt(new r(function(t){return t(e)}),t)}else this._willSettleAt(n(e),t)},e.prototype._settledAt=function(e,t,r){var n=this.promise;n._state===Z&&(this._remaining--,e===Q?_(n,r):this._result[t]=r),0===this._remaining&&E(n,this._result)},e.prototype._willSettleAt=function(e,t){var r=this;S(e,void 0,function(e){return r._settledAt(Y,t,e)},function(e){return r._settledAt(Q,t,e)})},e}(),ne=function(){function e(t){this[J]=j(),this._result=this._state=void 0,this._subscribers=[],f!==t&&("function"!=typeof t&&R(),this instanceof e?k(this,t):D())}return e.prototype.catch=function(e){return this.then(null,e)},e.prototype.finally=function(e){var t=this,r=t.constructor;return n(e)?t.then(function(t){return r.resolve(e()).then(function(){return t})},function(t){return r.resolve(e()).then(function(){throw t})}):t.then(e,e)},e}();return ne.prototype.then=c,ne.all=x,ne.race=I,ne.resolve=l,ne.reject=N,ne._setScheduler=o,ne._setAsap=i,ne._asap=B,ne.polyfill=M,ne.Promise=ne,ne}()}()}).call(t,r(30),r(8))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,r){"use strict";function n(e){return null!==e&&"object"==typeof e}e.exports=n},function(e,t,r){"use strict";var n=r(18),o=r(19),i=r(26),a=r(27),s=r(72),u=Array.prototype.slice,c=a(),l=function(e,t){o.RequireObjectCoercible(e);var r=u.call(arguments,1);return c.apply(e,r)};n(l,{getPolyfill:a,implementation:i,shim:s}),e.exports=l},function(e,t,r){"use strict";var n=r(57),o="function"==typeof Symbol&&"symbol"==typeof Symbol("foo"),i=Object.prototype.toString,a=Array.prototype.concat,s=Object.defineProperty,u=function(e){return"function"==typeof e&&"[object Function]"===i.call(e)},c=s&&function(){var e={};try{s(e,"x",{enumerable:!1,value:e});for(var t in e)return!1;return e.x===e}catch(e){return!1}}(),l=function(e,t,r,n){(!(t in e)||u(n)&&n())&&(c?s(e,t,{configurable:!0,enumerable:!1,value:r,writable:!0}):e[t]=r)},f=function(e,t){var r=arguments.length>2?arguments[2]:{},i=n(t);o&&(i=a.call(i,Object.getOwnPropertySymbols(t)));for(var s=0;s<i.length;s+=1)l(e,i[s],t[i[s]],r[i[s]])};f.supportsDescriptors=!!c,e.exports=f},function(e,t,r){"use strict";e.exports=r(59)},function(e,t){e.exports=function(e){return null===e||"function"!=typeof e&&"object"!=typeof e}},function(e,t,r){"use strict";var n,o,i=Object.getOwnPropertyDescriptor?function(){return Object.getOwnPropertyDescriptor(arguments,"callee").get}():function(){throw new TypeError},a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator,s=Object.getPrototypeOf||function(e){return e.__proto__},u=n?s(n):void 0,c=o?s(o):void 0,l=o?o():void 0,f="undefined"==typeof Uint8Array?void 0:s(Uint8Array),h={"$ %Array%":Array,"$ %ArrayBuffer%":"undefined"==typeof ArrayBuffer?void 0:ArrayBuffer,"$ %ArrayBufferPrototype%":"undefined"==typeof ArrayBuffer?void 0:ArrayBuffer.prototype,"$ %ArrayIteratorPrototype%":a?s([][Symbol.iterator]()):void 0,"$ %ArrayPrototype%":Array.prototype,"$ %ArrayProto_entries%":Array.prototype.entries,"$ %ArrayProto_forEach%":Array.prototype.forEach,"$ %ArrayProto_keys%":Array.prototype.keys,"$ %ArrayProto_values%":Array.prototype.values,"$ %AsyncFromSyncIteratorPrototype%":void 0,"$ %AsyncFunction%":void 0,"$ %AsyncFunctionPrototype%":void 0,"$ %AsyncGenerator%":o?s(l):void 0,"$ %AsyncGeneratorFunction%":c,"$ %AsyncGeneratorPrototype%":c?c.prototype:void 0,"$ %AsyncIteratorPrototype%":l&&a&&Symbol.asyncIterator?l[Symbol.asyncIterator]():void 0,"$ %Atomics%":"undefined"==typeof Atomics?void 0:Atomics,"$ %Boolean%":Boolean,"$ %BooleanPrototype%":Boolean.prototype,"$ %DataView%":"undefined"==typeof DataView?void 0:DataView,"$ %DataViewPrototype%":"undefined"==typeof DataView?void 0:DataView.prototype,"$ %Date%":Date,"$ %DatePrototype%":Date.prototype,"$ %decodeURI%":decodeURI,"$ %decodeURIComponent%":decodeURIComponent,"$ %encodeURI%":encodeURI,"$ %encodeURIComponent%":encodeURIComponent,"$ %Error%":Error,"$ %ErrorPrototype%":Error.prototype,"$ %eval%":eval,"$ %EvalError%":EvalError,"$ %EvalErrorPrototype%":EvalError.prototype,"$ %Float32Array%":"undefined"==typeof Float32Array?void 0:Float32Array,"$ %Float32ArrayPrototype%":"undefined"==typeof Float32Array?void 0:Float32Array.prototype,"$ %Float64Array%":"undefined"==typeof Float64Array?void 0:Float64Array,"$ %Float64ArrayPrototype%":"undefined"==typeof Float64Array?void 0:Float64Array.prototype,"$ %Function%":Function,"$ %FunctionPrototype%":Function.prototype,"$ %Generator%":n?s(n()):void 0,"$ %GeneratorFunction%":u,"$ %GeneratorPrototype%":u?u.prototype:void 0,"$ %Int8Array%":"undefined"==typeof Int8Array?void 0:Int8Array,"$ %Int8ArrayPrototype%":"undefined"==typeof Int8Array?void 0:Int8Array.prototype,"$ %Int16Array%":"undefined"==typeof Int16Array?void 0:Int16Array,"$ %Int16ArrayPrototype%":"undefined"==typeof Int16Array?void 0:Int8Array.prototype,"$ %Int32Array%":"undefined"==typeof Int32Array?void 0:Int32Array,"$ %Int32ArrayPrototype%":"undefined"==typeof Int32Array?void 0:Int32Array.prototype,"$ %isFinite%":isFinite,"$ %isNaN%":isNaN,"$ %IteratorPrototype%":a?s(s([][Symbol.iterator]())):void 0,"$ %JSON%":JSON,"$ %JSONParse%":JSON.parse,"$ %Map%":"undefined"==typeof Map?void 0:Map,"$ %MapIteratorPrototype%":"undefined"!=typeof Map&&a?s((new Map)[Symbol.iterator]()):void 0,"$ %MapPrototype%":"undefined"==typeof Map?void 0:Map.prototype,"$ %Math%":Math,"$ %Number%":Number,"$ %NumberPrototype%":Number.prototype,"$ %Object%":Object,"$ %ObjectPrototype%":Object.prototype,"$ %ObjProto_toString%":Object.prototype.toString,"$ %ObjProto_valueOf%":Object.prototype.valueOf,"$ %parseFloat%":parseFloat,"$ %parseInt%":parseInt,"$ %Promise%":"undefined"==typeof Promise?void 0:Promise,"$ %PromisePrototype%":"undefined"==typeof Promise?void 0:Promise.prototype,"$ %PromiseProto_then%":"undefined"==typeof Promise?void 0:Promise.prototype.then,"$ %Promise_all%":"undefined"==typeof Promise?void 0:Promise.all,"$ %Promise_reject%":"undefined"==typeof Promise?void 0:Promise.reject,"$ %Promise_resolve%":"undefined"==typeof Promise?void 0:Promise.resolve,"$ %Proxy%":"undefined"==typeof Proxy?void 0:Proxy,"$ %RangeError%":RangeError,"$ %RangeErrorPrototype%":RangeError.prototype,"$ %ReferenceError%":ReferenceError,"$ %ReferenceErrorPrototype%":ReferenceError.prototype,"$ %Reflect%":"undefined"==typeof Reflect?void 0:Reflect,"$ %RegExp%":RegExp,"$ %RegExpPrototype%":RegExp.prototype,"$ %Set%":"undefined"==typeof Set?void 0:Set,"$ %SetIteratorPrototype%":"undefined"!=typeof Set&&a?s((new Set)[Symbol.iterator]()):void 0,"$ %SetPrototype%":"undefined"==typeof Set?void 0:Set.prototype,"$ %SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?void 0:SharedArrayBuffer,"$ %SharedArrayBufferPrototype%":"undefined"==typeof SharedArrayBuffer?void 0:SharedArrayBuffer.prototype,"$ %String%":String,"$ %StringIteratorPrototype%":a?s(""[Symbol.iterator]()):void 0,"$ %StringPrototype%":String.prototype,"$ %Symbol%":a?Symbol:void 0,"$ %SymbolPrototype%":a?Symbol.prototype:void 0,"$ %SyntaxError%":SyntaxError,"$ %SyntaxErrorPrototype%":SyntaxError.prototype,"$ %ThrowTypeError%":i,"$ %TypedArray%":f,"$ %TypedArrayPrototype%":f?f.prototype:void 0,"$ %TypeError%":TypeError,"$ %TypeErrorPrototype%":TypeError.prototype,"$ %Uint8Array%":"undefined"==typeof Uint8Array?void 0:Uint8Array,"$ %Uint8ArrayPrototype%":"undefined"==typeof Uint8Array?void 0:Uint8Array.prototype,"$ %Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?void 0:Uint8ClampedArray,"$ %Uint8ClampedArrayPrototype%":"undefined"==typeof Uint8ClampedArray?void 0:Uint8ClampedArray.prototype,"$ %Uint16Array%":"undefined"==typeof Uint16Array?void 0:Uint16Array,"$ %Uint16ArrayPrototype%":"undefined"==typeof Uint16Array?void 0:Uint16Array.prototype,"$ %Uint32Array%":"undefined"==typeof Uint32Array?void 0:Uint32Array,"$ %Uint32ArrayPrototype%":"undefined"==typeof Uint32Array?void 0:Uint32Array.prototype,"$ %URIError%":URIError,"$ %URIErrorPrototype%":URIError.prototype,"$ %WeakMap%":"undefined"==typeof WeakMap?void 0:WeakMap,"$ %WeakMapPrototype%":"undefined"==typeof WeakMap?void 0:WeakMap.prototype,"$ %WeakSet%":"undefined"==typeof WeakSet?void 0:WeakSet,"$ %WeakSetPrototype%":"undefined"==typeof WeakSet?void 0:WeakSet.prototype};e.exports=function(e,t){if(arguments.length>1&&"boolean"!=typeof t)throw new TypeError('"allowMissing" argument must be a boolean');var r="$ "+e;if(!(r in h))throw new SyntaxError("intrinsic "+e+" does not exist!");if(void 0===h[r]&&!t)throw new TypeError("intrinsic "+e+" exists, but is not available. Please file an issue!");return h[r]}},function(e,t){e.exports=Number.isNaN||function(e){return e!==e}},function(e,t){var r=Number.isNaN||function(e){return e!==e};e.exports=Number.isFinite||function(e){return"number"==typeof e&&!r(e)&&e!==1/0&&e!==-1/0}},function(e,t){e.exports=function(e){return e>=0?1:-1}},function(e,t){e.exports=function(e,t){var r=e%t;return Math.floor(r>=0?r:r+t)}},function(e,t,r){"use strict";var n=r(19);e.exports=function(e){var t=n.ToObject(this),r=n.ToInteger(n.ToLength(t.length));if(!n.IsCallable(e))throw new TypeError("Array#find: predicate must be a function");if(0!==r)for(var o,i=arguments[1],a=0;a<r;a++)if(o=t[a],n.Call(e,i,[o,a,t]))return o}},function(e,t,r){"use strict";e.exports=function(){return Array.prototype.find&&1!==[,1].find(function(){return!0})?Array.prototype.find:r(26)}},function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}function s(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?u(e):t}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var h=r(6),p=r(0).Validator,d=r(3),y=d.TypeError,m=d.InstanceTypeError,v=r(1),g=v.ViewedDataSchema,b=v.FeedbackSchema,w=v.UserSchema,E=2500,_=new p;_.addSchema(w,"/User");var S=function(e){function t(e){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(o(this,t),!e)throw new Error("The object passed as parameter cannot be empty");var i=new p;i.addSchema(b,"/Feedback"),i.addSchema(w,"/User");var a=i.validate(e,g);if(!a.valid)throw new Error(a.errors);r=s(this,c(t).call(this)),r.secondBeforeSend=E,Object.keys(n).forEach(function(e){r[e]=n[e]});var u=e.feedback,l=e.layout;return r.mediasSent=[],r._setFeedback(u),r._setLayout(l),r}return l(t,e),a(t,[{key:"_setFeedback",value:function(e){if(!e)throw new m("feedback","Feedback");var t=_.validate(e,b);if(!t.valid)throw new Error(t.errors);this.feedback=e}},{key:"_setLayout",value:function(e){if(!e||0===e.length||"string"!=typeof e)throw new y("layout","string");this.layout=e}}]),t}(h);e.exports=S},function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){i(e,t,r[t])})}return e}function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?p(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t,r){return t&&c(e.prototype,t),r&&c(e,r),e}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}!function(e,t){e.BDAnalytics||(e.BDAnalytics=function(){var e=window.Promise||r(14).Promise,t=r(4),n=r(5),i=r(6),c=r(38),h=r(47),d=r(52),y=d.reco,m=d.setRecoRegression,v=r(53),g=v.click,b=v.setClickRegression,w=r(54),E=w.feedback,_=r(55),S=_.recommendation,T=r(56),O=T.viewedScroll,A=r(73),k=A.viewedRelated,j=null,P=!1,C={screen:{path:"",type:"",id:null},articleTag:""},x={user:t,media:n};return function(r){function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(a(this,n),e=s(this,u(n).call(this)),j)return s(e,j);if(!(r.user instanceof t))throw new Error("The user is not an instance of User");if(!r.partnerKey)throw new Error("The partnerKey is missing");return e.user=r.user,e.partnerKey=r.partnerKey,e.initConnection(r),e.q=[],e.isConnected=!1,j=p(p(e)),e}return f(n,r),l(n,null,[{key:"throttle",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,n=null;return function(){var o=arguments,i=performance.now();n&&i<n+t||(n=i,e.apply(r,o))}}},{key:"setScreen",value:function(e){C.screen=e}},{key:"isValidScreen",value:function(){return Boolean(C.screen.path)}},{key:"setArticleTag",value:function(e){C.articleTag=e}},{key:"getSchema",value:function(e){if(!x.hasOwnProperty(e.toLowerCase()))throw new Error("The schema: ".concat(e,", don't exist"));return x[e.toLowerCase()]}},{key:"setRegression",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];m(e),b(e),P=e}},{key:"getRegression",value:function(){return P}}]),l(n,[{key:"initConnection",value:function(e){var t=this;new(e.isHttp?c.HttpConnection:c.WsConnection)(e.user,e.partnerKey,C.screen).on("login",function(e){t._sender=e,t.isConnected=!0,t.q.forEach(function(t){var r=t.key,n=t.payload;if(n.hasOwnProperty("payload")){var o=e(r,n.payload);n.queue.forEach(function(e){var t=e.key,r=e.fct;return o.receive(t,r)})}else e(r,n)}),t.q=[]})}},{key:"_senderInterface",value:function(t,r){return this.isConnected?this._sender(t,r):this.q.push({key:t,payload:r}),e.resolve("ok")}},{key:"_biDerectionalInterface",value:function(e,t){if(this.isConnected)return this._sender(e,t);var r=[],n={receive:function(e,t){return r.push({key:e,fct:t}),n}};return this.q.push({key:e,payload:{payload:t,queue:r}}),n}},{key:"getTracker",value:function(){if(!this.tracker){var e=h(C,this._senderInterface.bind(this));this.tracker=new e(this.user)}return this.tracker}},{key:"getReco",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!e)throw new Error("data cannot be null");var t=y(c.GetConnection({partnerKey:this.partnerKey}));return this.reco=new t(o({},e,{user:this.user})),this.reco}},{key:"getClick",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!e)throw new Error("data cannot be null");var t=g(c.PostConnection({path:"/api/v".concat("2.0","/clicks"),partnerKey:this.partnerKey}));return this.click=new t(o({},e,{user:this.user,partnerKey:this.partnerKey})),this.click}},{key:"getFeedback",value:function(e){return new(E(this._biDerectionalInterface.bind(this)))({action:e,user:this.user})}},{key:"getRecommendation",value:function(){return new(S(this._biDerectionalInterface.bind(this)))({user:this.user})}},{key:"viewedRecommendation",value:function(e){var t=this.getFeedback("viewed");return new(O())({feedback:t,data:e})}},{key:"relatedRecommendation",value:function(e){var t=this.getFeedback("viewed");return new(k())({feedback:t,data:e})}}]),n}(i)}())}(window)},function(e,t){function r(){throw new Error("setTimeout has not been defined")}function n(){throw new Error("clearTimeout has not been defined")}function o(e){if(l===setTimeout)return setTimeout(e,0);if((l===r||!l)&&setTimeout)return l=setTimeout,setTimeout(e,0);try{return l(e,0)}catch(t){try{return l.call(null,e,0)}catch(t){return l.call(this,e,0)}}}function i(e){if(f===clearTimeout)return clearTimeout(e);if((f===n||!f)&&clearTimeout)return f=clearTimeout,clearTimeout(e);try{return f(e)}catch(t){try{return f.call(null,e)}catch(t){return f.call(this,e)}}}function a(){y&&p&&(y=!1,p.length?d=p.concat(d):m=-1,d.length&&s())}function s(){if(!y){var e=o(a);y=!0;for(var t=d.length;t;){for(p=d,d=[];++m<t;)p&&p[m].run();m=-1,t=d.length}p=null,y=!1,i(e)}}function u(e,t){this.fun=e,this.array=t}function c(){}var l,f,h=e.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:r}catch(e){l=r}try{f="function"==typeof clearTimeout?clearTimeout:n}catch(e){f=n}}();var p,d=[],y=!1,m=-1;h.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];d.push(new u(e,t)),1!==d.length||y||o(s)},u.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=c,h.addListener=c,h.once=c,h.off=c,h.removeListener=c,h.removeAllListeners=c,h.emit=c,h.prependListener=c,h.prependOnceListener=c,h.listeners=function(e){return[]},h.binding=function(e){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(e){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},function(e,t,r){"use strict";function n(e){var t="string"==typeof e?e:e.$ref;return"string"==typeof t&&t}var o=r(9),i=r(37),a=r(2),s=r(10).scan,u=a.ValidatorResult,c=a.SchemaError,l=a.SchemaContext,f=function e(){this.customFormats=Object.create(e.prototype.customFormats),this.schemas={},this.unresolvedRefs=[],this.types=Object.create(h),this.attributes=Object.create(i.validators)};f.prototype.customFormats={},f.prototype.schemas=null,f.prototype.types=null,f.prototype.attributes=null,f.prototype.unresolvedRefs=null,f.prototype.addSchema=function(e,t){var r=this;if(!e)return null;var n=s(t||"/",e),o=t||e.id;for(var i in n.id)this.schemas[i]=n.id[i];for(var i in n.ref)this.unresolvedRefs.push(i);return this.unresolvedRefs=this.unresolvedRefs.filter(function(e){return void 0===r.schemas[e]}),this.schemas[o]},f.prototype.addSubSchemaArray=function(e,t){if(t instanceof Array)for(var r=0;r<t.length;r++)this.addSubSchema(e,t[r])},f.prototype.addSubSchemaObject=function(e,t){if(t&&"object"==typeof t)for(var r in t)this.addSubSchema(e,t[r])},f.prototype.setSchemas=function(e){this.schemas=e},f.prototype.getSchema=function(e){return this.schemas[e]},f.prototype.validate=function(e,t,r,n){r||(r={});var i=r.propertyName||"instance",a=o.resolve(r.base||"/",t.id||"");if(!n){n=new l(t,r,i,a,Object.create(this.schemas)),n.schemas[a]||(n.schemas[a]=t);var u=s(a,t);for(var f in u.id){var h=u.id[f];n.schemas[f]=h}}if(t){var p=this.validateSchema(e,t,r,n);if(!p)throw new Error("Result undefined");return p}throw new c("no schema specified",t)},f.prototype.validateSchema=function(e,t,r,o){var s=new u(e,t,r,o);if("boolean"==typeof t)!0===t?t={}:!1===t&&(t={type:[]});else if(!t)throw new Error("schema is undefined");if(t.extends)if(t.extends instanceof Array){var f={schema:t,ctx:o};t.extends.forEach(this.schemaTraverser.bind(this,f)),t=f.schema,f.schema=null,f.ctx=null,f=null}else t=a.deepMerge(t,this.superResolve(t.extends,o));var h;if(h=n(t)){var p=this.resolve(t,h,o),d=new l(p.subschema,r,o.propertyPath,p.switchSchema,o.schemas);return this.validateSchema(e,p.subschema,r,d)}var y=r&&r.skipAttributes||[];for(var m in t)if(!i.ignoreProperties[m]&&y.indexOf(m)<0){var v=null,g=this.attributes[m];if(g)v=g.call(this,e,t,r,o);else if(!1===r.allowUnknownAttributes)throw new c("Unsupported attribute: "+m,t);v&&s.importErrors(v)}if("function"==typeof r.rewrite){var b=r.rewrite.call(this,e,t,r,o);s.instance=b}return s},f.prototype.schemaTraverser=function(e,t){e.schema=a.deepMerge(e.schema,this.superResolve(t,e.ctx))},f.prototype.superResolve=function(e,t){var r;return(r=n(e))?this.resolve(e,r,t).subschema:e},f.prototype.resolve=function(e,t,r){if(t=r.resolve(t),r.schemas[t])return{subschema:r.schemas[t],switchSchema:t};var n=o.parse(t),i=n&&n.hash,s=i&&i.length&&t.substr(0,t.length-i.length);if(!s||!r.schemas[s])throw new c("no such schema <"+t+">",e);var u=a.objectGetPath(r.schemas[s],i.substr(1));if(void 0===u)throw new c("no such schema "+i+" located in <"+s+">",e);return{subschema:u,switchSchema:t}},f.prototype.testType=function(e,t,r,n,o){if("function"==typeof this.types[o])return this.types[o].call(this,e);if(o&&"object"==typeof o){var i=this.validateSchema(e,o,r,n);return void 0===i||!(i&&i.errors.length)}return!0};var h=f.prototype.types={};h.string=function(e){return"string"==typeof e},h.number=function(e){return"number"==typeof e&&isFinite(e)},h.integer=function(e){return"number"==typeof e&&e%1==0},h.boolean=function(e){return"boolean"==typeof e},h.array=function(e){return Array.isArray(e)},h.null=function(e){return null===e},h.date=function(e){return e instanceof Date},h.any=function(e){return!0},h.object=function(e){return e&&"object"==typeof e&&!(e instanceof Array)&&!(e instanceof Date)},e.exports=f},function(e,t,r){(function(e,n){var o;!function(n){function i(e){throw new RangeError(C[e])}function a(e,t){for(var r=e.length,n=[];r--;)n[r]=t(e[r]);return n}function s(e,t){var r=e.split("@"),n="";return r.length>1&&(n=r[0]+"@",e=r[1]),e=e.replace(P,"."),n+a(e.split("."),t).join(".")}function u(e){for(var t,r,n=[],o=0,i=e.length;o<i;)t=e.charCodeAt(o++),t>=55296&&t<=56319&&o<i?(r=e.charCodeAt(o++),56320==(64512&r)?n.push(((1023&t)<<10)+(1023&r)+65536):(n.push(t),o--)):n.push(t);return n}function c(e){return a(e,function(e){var t="";return e>65535&&(e-=65536,t+=N(e>>>10&1023|55296),e=56320|1023&e),t+=N(e)}).join("")}function l(e){return e-48<10?e-22:e-65<26?e-65:e-97<26?e-97:b}function f(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function h(e,t,r){var n=0;for(e=r?I(e/S):e>>1,e+=I(e/t);e>x*E>>1;n+=b)e=I(e/x);return I(n+(x+1)*e/(e+_))}function p(e){var t,r,n,o,a,s,u,f,p,d,y=[],m=e.length,v=0,_=O,S=T;for(r=e.lastIndexOf(A),r<0&&(r=0),n=0;n<r;++n)e.charCodeAt(n)>=128&&i("not-basic"),y.push(e.charCodeAt(n));for(o=r>0?r+1:0;o<m;){for(a=v,s=1,u=b;o>=m&&i("invalid-input"),f=l(e.charCodeAt(o++)),(f>=b||f>I((g-v)/s))&&i("overflow"),v+=f*s,p=u<=S?w:u>=S+E?E:u-S,!(f<p);u+=b)d=b-p,s>I(g/d)&&i("overflow"),s*=d;t=y.length+1,S=h(v-a,t,0==a),I(v/t)>g-_&&i("overflow"),_+=I(v/t),v%=t,y.splice(v++,0,_)}return c(y)}function d(e){var t,r,n,o,a,s,c,l,p,d,y,m,v,_,S,k=[];for(e=u(e),m=e.length,t=O,r=0,a=T,s=0;s<m;++s)(y=e[s])<128&&k.push(N(y));for(n=o=k.length,o&&k.push(A);n<m;){for(c=g,s=0;s<m;++s)(y=e[s])>=t&&y<c&&(c=y);for(v=n+1,c-t>I((g-r)/v)&&i("overflow"),r+=(c-t)*v,t=c,s=0;s<m;++s)if(y=e[s],y<t&&++r>g&&i("overflow"),y==t){for(l=r,p=b;d=p<=a?w:p>=a+E?E:p-a,!(l<d);p+=b)S=l-d,_=b-d,k.push(N(f(d+S%_,0))),l=I(S/_);k.push(N(f(l,0))),a=h(r,v,n==o),r=0,++n}++r,++t}return k.join("")}function y(e){return s(e,function(e){return k.test(e)?p(e.slice(4).toLowerCase()):e})}function m(e){return s(e,function(e){return j.test(e)?"xn--"+d(e):e})}var v,g=("object"==typeof t&&t&&t.nodeType,"object"==typeof e&&e&&e.nodeType,2147483647),b=36,w=1,E=26,_=38,S=700,T=72,O=128,A="-",k=/^xn--/,j=/[^\x20-\x7E]/,P=/[\x2E\u3002\uFF0E\uFF61]/g,C={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},x=b-w,I=Math.floor,N=String.fromCharCode;v={version:"1.4.1",ucs2:{decode:u,encode:c},decode:p,encode:d,toASCII:m,toUnicode:y},void 0!==(o=function(){return v}.call(t,r,t,e))&&(e.exports=o)}()}).call(t,r(15)(e),r(8))},function(e,t,r){"use strict";e.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},function(e,t,r){"use strict";t.decode=t.parse=r(35),t.encode=t.stringify=r(36)},function(e,t,r){"use strict";function n(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,t,r,i){t=t||"&",r=r||"=";var a={};if("string"!=typeof e||0===e.length)return a;var s=/\+/g;e=e.split(t);var u=1e3;i&&"number"==typeof i.maxKeys&&(u=i.maxKeys);var c=e.length;u>0&&c>u&&(c=u);for(var l=0;l<c;++l){var f,h,p,d,y=e[l].replace(s,"%20"),m=y.indexOf(r);m>=0?(f=y.substr(0,m),h=y.substr(m+1)):(f=y,h=""),p=decodeURIComponent(f),d=decodeURIComponent(h),n(a,p)?o(a[p])?a[p].push(d):a[p]=[a[p],d]:a[p]=d}return a};var o=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},function(e,t,r){"use strict";function n(e,t){if(e.map)return e.map(t);for(var r=[],n=0;n<e.length;n++)r.push(t(e[n],n));return r}var o=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,t,r,s){return t=t||"&",r=r||"=",null===e&&(e=void 0),"object"==typeof e?n(a(e),function(a){var s=encodeURIComponent(o(a))+r;return i(e[a])?n(e[a],function(e){return s+encodeURIComponent(o(e))}).join(t):s+encodeURIComponent(o(e[a]))}).join(t):s?encodeURIComponent(o(s))+r+encodeURIComponent(o(e)):""};var i=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},a=Object.keys||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t}},function(e,t,r){"use strict";function n(e,t,r,n,o){var i=t.throwError;t.throwError=!1;var a=this.validateSchema(e,o,t,r);return t.throwError=i,!a.valid&&n instanceof Function&&n(a),a.valid}function o(e,t,r,n,o,i){if(this.types.object(e)&&(!t.properties||void 0===t.properties[o]))if(!1===t.additionalProperties)i.addError({name:"additionalProperties",argument:o,message:"additionalProperty "+JSON.stringify(o)+" exists in instance when not allowed"});else{var a=t.additionalProperties||{};"function"==typeof r.preValidateProperty&&r.preValidateProperty(e,o,a,r,n);var s=this.validateSchema(e[o],a,r,n.makeChild(a,o));s.instance!==i.instance[o]&&(i.instance[o]=s.instance),i.importErrors(s)}}function i(e,t,r){var n,o=r.length;for(n=t+1,o;n<o;n++)if(a.deepCompareStrict(e,r[n]))return!1;return!0}var a=r(2),s=a.ValidatorResult,u=a.SchemaError,c={};c.ignoreProperties={id:!0,default:!0,description:!0,title:!0,exclusiveMinimum:!0,exclusiveMaximum:!0,additionalItems:!0,$schema:!0,$ref:!0,extends:!0};var l=c.validators={};l.type=function(e,t,r,n){if(void 0===e)return null;var o=new s(e,t,r,n),i=Array.isArray(t.type)?t.type:[t.type];if(!i.some(this.testType.bind(this,e,t,r,n))){var a=i.map(function(e){return e.id&&"<"+e.id+">"||e+""});o.addError({name:"type",argument:a,message:"is not of a type(s) "+a})}return o},l.anyOf=function(e,t,r,o){if(void 0===e)return null;var i=new s(e,t,r,o),a=new s(e,t,r,o);if(!Array.isArray(t.anyOf))throw new u("anyOf must be an array");if(!t.anyOf.some(n.bind(this,e,r,o,function(e){a.importErrors(e)}))){var c=t.anyOf.map(function(e,t){return e.id&&"<"+e.id+">"||e.title&&JSON.stringify(e.title)||e.$ref&&"<"+e.$ref+">"||"[subschema "+t+"]"});r.nestedErrors&&i.importErrors(a),i.addError({name:"anyOf",argument:c,message:"is not any of "+c.join(",")})}return i},l.allOf=function(e,t,r,n){if(void 0===e)return null;if(!Array.isArray(t.allOf))throw new u("allOf must be an array");var o=new s(e,t,r,n),i=this;return t.allOf.forEach(function(t,a){var s=i.validateSchema(e,t,r,n);if(!s.valid){var u=t.id&&"<"+t.id+">"||t.title&&JSON.stringify(t.title)||t.$ref&&"<"+t.$ref+">"||"[subschema "+a+"]";o.addError({name:"allOf",argument:{id:u,length:s.errors.length,valid:s},message:"does not match allOf schema "+u+" with "+s.errors.length+" error[s]:"}),o.importErrors(s)}}),o},l.oneOf=function(e,t,r,o){if(void 0===e)return null;if(!Array.isArray(t.oneOf))throw new u("oneOf must be an array");var i=new s(e,t,r,o),a=new s(e,t,r,o),c=t.oneOf.filter(n.bind(this,e,r,o,function(e){a.importErrors(e)})).length,l=t.oneOf.map(function(e,t){return e.id&&"<"+e.id+">"||e.title&&JSON.stringify(e.title)||e.$ref&&"<"+e.$ref+">"||"[subschema "+t+"]"});return 1!==c&&(r.nestedErrors&&i.importErrors(a),i.addError({name:"oneOf",argument:l,message:"is not exactly one from "+l.join(",")})),i},l.properties=function(e,t,r,n){if(this.types.object(e)){var o=new s(e,t,r,n),i=t.properties||{};for(var a in i){"function"==typeof r.preValidateProperty&&r.preValidateProperty(e,a,i[a],r,n);var u=Object.hasOwnProperty.call(e,a)?e[a]:void 0,c=this.validateSchema(u,i[a],r,n.makeChild(i[a],a));c.instance!==o.instance[a]&&(o.instance[a]=c.instance),o.importErrors(c)}return o}},l.patternProperties=function(e,t,r,n){if(this.types.object(e)){var i=new s(e,t,r,n),a=t.patternProperties||{};for(var u in e){var c=!0;for(var l in a)if(new RegExp(l).test(u)){c=!1,"function"==typeof r.preValidateProperty&&r.preValidateProperty(e,u,a[l],r,n);var f=this.validateSchema(e[u],a[l],r,n.makeChild(a[l],u));f.instance!==i.instance[u]&&(i.instance[u]=f.instance),i.importErrors(f)}c&&o.call(this,e,t,r,n,u,i)}return i}},l.additionalProperties=function(e,t,r,n){if(this.types.object(e)){if(t.patternProperties)return null;var i=new s(e,t,r,n);for(var a in e)o.call(this,e,t,r,n,a,i);return i}},l.minProperties=function(e,t,r,n){if(this.types.object(e)){var o=new s(e,t,r,n);return Object.keys(e).length>=t.minProperties||o.addError({name:"minProperties",argument:t.minProperties,message:"does not meet minimum property length of "+t.minProperties}),o}},l.maxProperties=function(e,t,r,n){if(this.types.object(e)){var o=new s(e,t,r,n);return Object.keys(e).length<=t.maxProperties||o.addError({name:"maxProperties",argument:t.maxProperties,message:"does not meet maximum property length of "+t.maxProperties}),o}},l.items=function(e,t,r,n){var o=this;if(this.types.array(e)&&t.items){var i=new s(e,t,r,n);return e.every(function(e,a){var s=Array.isArray(t.items)?t.items[a]||t.additionalItems:t.items;if(void 0===s)return!0;if(!1===s)return i.addError({name:"items",message:"additionalItems not permitted"}),!1;var u=o.validateSchema(e,s,r,n.makeChild(s,a));return u.instance!==i.instance[a]&&(i.instance[a]=u.instance),i.importErrors(u),!0}),i}},l.minimum=function(e,t,r,n){if(this.types.number(e)){var o=new s(e,t,r,n),i=!0;return i=t.exclusiveMinimum&&!0===t.exclusiveMinimum?e>t.minimum:e>=t.minimum,i||o.addError({name:"minimum",argument:t.minimum,message:"must have a minimum value of "+t.minimum}),o}},l.maximum=function(e,t,r,n){if(this.types.number(e)){var o,i=new s(e,t,r,n);return o=t.exclusiveMaximum&&!0===t.exclusiveMaximum?e<t.maximum:e<=t.maximum,o||i.addError({name:"maximum",argument:t.maximum,message:"must have a maximum value of "+t.maximum}),i}};var f=function(e,t,r,n,o,i){if(this.types.number(e)){var c=t[o];if(0==c)throw new u(o+" cannot be zero");var l=new s(e,t,r,n),f=a.getDecimalPlaces(e),h=a.getDecimalPlaces(c),p=Math.max(f,h),d=Math.pow(10,p);return Math.round(e*d)%Math.round(c*d)!=0&&l.addError({name:o,argument:c,message:i+JSON.stringify(c)}),l}};l.multipleOf=function(e,t,r,n){return f.call(this,e,t,r,n,"multipleOf","is not a multiple of (divisible by) ")},l.divisibleBy=function(e,t,r,n){return f.call(this,e,t,r,n,"divisibleBy","is not divisible by (multiple of) ")},l.required=function(e,t,r,n){var o=new s(e,t,r,n);return void 0===e&&!0===t.required?o.addError({name:"required",message:"is required"}):this.types.object(e)&&Array.isArray(t.required)&&t.required.forEach(function(t){void 0===e[t]&&o.addError({name:"required",argument:t,message:"requires property "+JSON.stringify(t)})}),o},l.pattern=function(e,t,r,n){if(this.types.string(e)){var o=new s(e,t,r,n);return e.match(t.pattern)||o.addError({name:"pattern",argument:t.pattern,message:"does not match pattern "+JSON.stringify(t.pattern)}),o}},l.format=function(e,t,r,n){if(void 0!==e){var o=new s(e,t,r,n);return o.disableFormat||a.isFormat(e,t.format,this)||o.addError({name:"format",argument:t.format,message:"does not conform to the "+JSON.stringify(t.format)+" format"}),o}},l.minLength=function(e,t,r,n){if(this.types.string(e)){var o=new s(e,t,r,n),i=e.match(/[\uDC00-\uDFFF]/g);return e.length-(i?i.length:0)>=t.minLength||o.addError({name:"minLength",argument:t.minLength,message:"does not meet minimum length of "+t.minLength}),o}},l.maxLength=function(e,t,r,n){if(this.types.string(e)){var o=new s(e,t,r,n),i=e.match(/[\uDC00-\uDFFF]/g);return e.length-(i?i.length:0)<=t.maxLength||o.addError({name:"maxLength",argument:t.maxLength,message:"does not meet maximum length of "+t.maxLength}),o}},l.minItems=function(e,t,r,n){if(this.types.array(e)){var o=new s(e,t,r,n);return e.length>=t.minItems||o.addError({name:"minItems",argument:t.minItems,message:"does not meet minimum length of "+t.minItems}),o}},l.maxItems=function(e,t,r,n){if(this.types.array(e)){var o=new s(e,t,r,n);return e.length<=t.maxItems||o.addError({name:"maxItems",argument:t.maxItems,message:"does not meet maximum length of "+t.maxItems}),o}},l.uniqueItems=function(e,t,r,n){function o(e,t,r){for(var n=t+1;n<r.length;n++)if(a.deepCompareStrict(e,r[n]))return!1;return!0}if(this.types.array(e)){var i=new s(e,t,r,n);return e.every(o)||i.addError({name:"uniqueItems",message:"contains duplicate item"}),i}},l.uniqueItems=function(e,t,r,n){if(this.types.array(e)){var o=new s(e,t,r,n);return e.every(i)||o.addError({name:"uniqueItems",message:"contains duplicate item"}),o}},l.dependencies=function(e,t,r,n){if(this.types.object(e)){var o=new s(e,t,r,n);for(var i in t.dependencies)if(void 0!==e[i]){var a=t.dependencies[i],u=n.makeChild(a,i);if("string"==typeof a&&(a=[a]),Array.isArray(a))a.forEach(function(t){void 0===e[t]&&o.addError({name:"dependencies",argument:u.propertyPath,message:"property "+t+" not found, required by "+u.propertyPath})});else{var c=this.validateSchema(e,a,r,u);o.instance!==c.instance&&(o.instance=c.instance),c&&c.errors.length&&(o.addError({name:"dependencies",argument:u.propertyPath,message:"does not meet dependency required by "+u.propertyPath}),o.importErrors(c))}}return o}},l.enum=function(e,t,r,n){if(void 0===e)return null;if(!Array.isArray(t.enum))throw new u("enum expects an array",t);var o=new s(e,t,r,n);return t.enum.some(a.deepCompareStrict.bind(null,e))||o.addError({name:"enum",argument:t.enum,message:"is not one of enum values: "+t.enum.map(String).join(",")}),o},l.const=function(e,t,r,n){if(void 0===e)return null;var o=new s(e,t,r,n);return a.deepCompareStrict(t.const,e)||o.addError({name:"const",argument:t.const,message:"does not exactly match expected constant: "+t.const}),o},l.not=l.disallow=function(e,t,r,n){var o=this;if(void 0===e)return null;var i=new s(e,t,r,n),a=t.not||t.disallow;return a?(Array.isArray(a)||(a=[a]),a.forEach(function(a){if(o.testType(e,t,r,n,a)){var s=a&&a.id&&"<"+a.id+">"||a;i.addError({name:"not",argument:s,message:"is of prohibited type "+s})}}),i):null},e.exports=c},function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){i(e,t,r[t])})}return e}function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){if(null==e)return{};var r,n,o=s(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function s(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t,r){return t&&c(e.prototype,t),r&&c(e,r),e}function f(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?y(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var m=r(39),v=m.Socket,g=window.Promise||r(14).Promise,b=r(40)(r(41),g),w=r(6),E=function(e){function t(e,r,n){var o;return u(this,t),o=f(this,h(t).call(this)),o.user=e,o.partnerKey=r,setTimeout(function(){o.emit("login",o._sendMessage.bind(y(y(o)))),o.isConnected=!0},10),o}return p(t,e),l(t,[{key:"_sendMessage",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=(t.time,a(t,["time"]));return S({path:r.path})(e,o({},n,{partner_key:this.partnerKey}),{timeout:r.timeout||5e3})}}]),t}(w),_=function(e){function t(e,r,n){var o;return u(this,t),o=f(this,h(t).call(this)),o.isConnected=!1,o.socket=null,o.channel=null,o._initConnection(e,r,n,o._initChannel.bind(y(y(o)))),o}return p(t,e),l(t,[{key:"_initConnection",value:function(e,t,r,n){var o=this;this.socket=new v("wss://".concat("tracker2.prd.bda.rtbf.be","/v").concat("2.0","/socket"),{params:{user:e,partnerKey:t,screen:r}}),this.socket.onOpen(function(){o.isConnected||n()}),this.socket.connect()}},{key:"_initChannel",value:function(){var e=this;this.channel=this.socket.channel("bda:track",{}),this.channel.join().receive("ok",function(){e.isConnected||(e.emit("login",e._sendMessage.bind(e)),e.isConnected=!0)})}},{key:"_sendMessage",value:function(e,t){return this.channel.push(e,t)}}]),t}(w),S=function(e){return function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=o({},e,n);return r=o({},r,{partner_key:i.partnerKey}),b.post("https://reco.prd.bda.rtbf.be".replace(/:8000$/,":8010")+i.path).send({key:t,payload:r}).timeout(Number(i.timeout||5e3)).then(function(e){return 204===e.statusCode&&(e.body={error:null,success:"ok"}),e}).then(function(e){var t=e.body,r=t.error,n=t.success;if(r)throw r;return n})}},T=function(e){var t=e.partnerKey;return function(e,r,n){var o=n.timeout,i=n.regression,a=void 0!==i&&i;return b.get("https://reco.prd.bda.rtbf.be"+e+r+"&"+(a?"partnerID="+t:"partner_key="+t)).timeout(Number(o)).then(function(e){return a&&(e.body={error:null,success:e.body}),204===e.statusCode&&(e.body={error:null,success:"ok"}),e}).then(function(e){var t=e.body,r=t.error,n=t.success;if(r)throw r;return n})}};e.exports={WsConnection:_,HttpConnection:E,PostConnection:S,GetConnection:T}},function(e,t,r){"use strict";function n(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s={connecting:0,open:1,closing:2,closed:3},u=1e4,c={closed:"closed",errored:"errored",joined:"joined",joining:"joining",leaving:"leaving"},l={close:"phx_close",error:"phx_error",join:"phx_join",reply:"phx_reply",leave:"phx_leave"},f={longpoll:"longpoll",websocket:"websocket"},h=function(){function e(t,r,n,i){o(this,e),this.channel=t,this.event=r,this.payload=n||{},this.receivedResp=null,this.timeout=i,this.timeoutTimer=null,this.recHooks=[],this.sent=!1}return a(e,[{key:"resend",value:function(e){this.timeout=e,this.cancelRefEvent(),this.ref=null,this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}},{key:"send",value:function(){this.hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref}))}},{key:"receive",value:function(e,t){return this.hasReceived(e)&&t(this.receivedResp.response),this.recHooks.push({status:e,callback:t}),this}},{key:"matchReceive",value:function(e){var t=e.status,r=e.response;e.ref,this.recHooks.filter(function(e){return e.status===t}).forEach(function(e){return e.callback(r)})}},{key:"cancelRefEvent",value:function(){this.refEvent&&this.channel.off(this.refEvent)}},{key:"cancelTimeout",value:function(){clearTimeout(this.timeoutTimer),this.timeoutTimer=null}},{key:"startTimeout",value:function(){var e=this;this.timeoutTimer||(this.ref=this.channel.socket.makeRef(),this.refEvent=this.channel.replyEventName(this.ref),this.channel.on(this.refEvent,function(t){e.cancelRefEvent(),e.cancelTimeout(),e.receivedResp=t,e.matchReceive(t)}),this.timeoutTimer=setTimeout(function(){e.trigger("timeout",{})},this.timeout))}},{key:"hasReceived",value:function(e){return this.receivedResp&&this.receivedResp.status===e}},{key:"trigger",value:function(e,t){this.channel.trigger(this.refEvent,{status:e,response:t})}}]),e}(),p=t.Channel=function(){function e(t,r,n){var i=this;o(this,e),this.state=c.closed,this.topic=t,this.params=r||{},this.socket=n,this.bindings=[],this.timeout=this.socket.timeout,this.joinedOnce=!1,this.joinPush=new h(this,l.join,this.params,this.timeout),this.pushBuffer=[],this.rejoinTimer=new m(function(){return i.rejoinUntilConnected()},this.socket.reconnectAfterMs),this.joinPush.receive("ok",function(){i.state=c.joined,i.rejoinTimer.reset(),i.pushBuffer.forEach(function(e){return e.send()}),i.pushBuffer=[]}),this.onClose(function(){i.rejoinTimer.reset(),i.socket.log("channel","close "+i.topic+" "+i.joinRef()),i.state=c.closed,i.socket.remove(i)}),this.onError(function(e){i.isLeaving()||i.isClosed()||(i.socket.log("channel","error "+i.topic,e),i.state=c.errored,i.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",function(){i.isJoining()&&(i.socket.log("channel","timeout "+i.topic,i.joinPush.timeout),i.state=c.errored,i.rejoinTimer.scheduleTimeout())}),this.on(l.reply,function(e,t){i.trigger(i.replyEventName(t),e)})}return a(e,[{key:"rejoinUntilConnected",value:function(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this.rejoin()}},{key:"join",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.timeout;if(this.joinedOnce)throw"tried to join multiple times. 'join' can only be called a single time per channel instance";return this.joinedOnce=!0,this.rejoin(e),this.joinPush}},{key:"onClose",value:function(e){this.on(l.close,e)}},{key:"onError",value:function(e){this.on(l.error,function(t){return e(t)})}},{key:"on",value:function(e,t){this.bindings.push({event:e,callback:t})}},{key:"off",value:function(e){this.bindings=this.bindings.filter(function(t){return t.event!==e})}},{key:"canPush",value:function(){return this.socket.isConnected()&&this.isJoined()}},{key:"push",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.timeout;if(!this.joinedOnce)throw"tried to push '"+e+"' to '"+this.topic+"' before joining. Use channel.join() before pushing events";var n=new h(this,e,t,r);return this.canPush()?n.send():(n.startTimeout(),this.pushBuffer.push(n)),n}},{key:"leave",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.timeout;this.state=c.leaving;var r=function(){e.socket.log("channel","leave "+e.topic),e.trigger(l.close,"leave",e.joinRef())},n=new h(this,l.leave,{},t);return n.receive("ok",function(){return r()}).receive("timeout",function(){return r()}),n.send(),this.canPush()||n.trigger("ok",{}),n}},{key:"onMessage",value:function(e,t,r){return t}},{key:"isMember",value:function(e){return this.topic===e}},{key:"joinRef",value:function(){return this.joinPush.ref}},{key:"sendJoin",value:function(e){this.state=c.joining,this.joinPush.resend(e)}},{key:"rejoin",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.timeout;this.isLeaving()||this.sendJoin(e)}},{key:"trigger",value:function(e,t,r){var n=l.close,o=l.error,i=l.leave,a=l.join;if(!(r&&[n,o,i,a].indexOf(e)>=0&&r!==this.joinRef())){var s=this.onMessage(e,t,r);if(t&&!s)throw"channel onMessage callbacks must return the payload, modified or unmodified";this.bindings.filter(function(t){return t.event===e}).map(function(e){return e.callback(s,r)})}}},{key:"replyEventName",value:function(e){return"chan_reply_"+e}},{key:"isClosed",value:function(){return this.state===c.closed}},{key:"isErrored",value:function(){return this.state===c.errored}},{key:"isJoined",value:function(){return this.state===c.joined}},{key:"isJoining",value:function(){return this.state===c.joining}},{key:"isLeaving",value:function(){return this.state===c.leaving}}]),e}(),d=(t.Socket=function(){function e(t){var r=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};o(this,e),this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.channels=[],this.sendBuffer=[],this.ref=0,this.timeout=n.timeout||u,this.transport=n.transport||window.WebSocket||d,this.heartbeatIntervalMs=n.heartbeatIntervalMs||3e4,this.reconnectAfterMs=n.reconnectAfterMs||function(e){return[1e3,2e3,5e3,1e4][e-1]||1e4},this.logger=n.logger||function(){},this.longpollerTimeout=n.longpollerTimeout||2e4,this.params=n.params||{},this.endPoint=t+"/"+f.websocket,this.reconnectTimer=new m(function(){r.disconnect(function(){return r.connect()})},this.reconnectAfterMs)}return a(e,[{key:"protocol",value:function(){return location.protocol.match(/^https/)?"wss":"ws"}},{key:"endPointURL",value:function(){var e=y.appendParams(y.appendParams(this.endPoint,this.params),{vsn:"1.0.0"});return"/"!==e.charAt(0)?e:"/"===e.charAt(1)?this.protocol()+":"+e:this.protocol()+"://"+location.host+e}},{key:"disconnect",value:function(e,t,r){this.conn&&(this.conn.onclose=function(){},t?this.conn.close(t,r||""):this.conn.close(),this.conn=null),e&&e()}},{key:"connect",value:function(e){var t=this;e&&(console,this.params=e),this.conn||(this.conn=new this.transport(this.endPointURL()),this.conn.timeout=this.longpollerTimeout,this.conn.onopen=function(){return t.onConnOpen()},this.conn.onerror=function(e){return t.onConnError(e)},this.conn.onmessage=function(e){return t.onConnMessage(e)},this.conn.onclose=function(e){return t.onConnClose(e)})}},{key:"log",value:function(e,t,r){this.logger(e,t,r)}},{key:"onOpen",value:function(e){this.stateChangeCallbacks.open.push(e)}},{key:"onClose",value:function(e){this.stateChangeCallbacks.close.push(e)}},{key:"onError",value:function(e){this.stateChangeCallbacks.error.push(e)}},{key:"onMessage",value:function(e){this.stateChangeCallbacks.message.push(e)}},{key:"onConnOpen",value:function(){var e=this;this.log("transport","connected to "+this.endPointURL(),this.transport.prototype),this.flushSendBuffer(),this.reconnectTimer.reset(),this.conn.skipHeartbeat||(clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(function(){return e.sendHeartbeat()},this.heartbeatIntervalMs)),this.stateChangeCallbacks.open.forEach(function(e){return e()})}},{key:"onConnClose",value:function(e){this.log("transport","close",e),this.triggerChanError(),clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(function(t){return t(e)})}},{key:"onConnError",value:function(e){this.log("transport",e),this.triggerChanError(),this.stateChangeCallbacks.error.forEach(function(t){return t(e)})}},{key:"triggerChanError",value:function(){this.channels.forEach(function(e){return e.trigger(l.error)})}},{key:"connectionState",value:function(){switch(this.conn&&this.conn.readyState){case s.connecting:return"connecting";case s.open:return"open";case s.closing:return"closing";default:return"closed"}}},{key:"isConnected",value:function(){return"open"===this.connectionState()}},{key:"remove",value:function(e){this.channels=this.channels.filter(function(t){return t.joinRef()!==e.joinRef()})}},{key:"channel",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=new p(e,t,this);return this.channels.push(r),r}},{key:"push",value:function(e){var t=this,r=e.topic,n=e.event,o=e.payload,i=e.ref,a=function(){return t.conn.send(JSON.stringify(e))};this.log("push",r+" "+n+" ("+i+")",o),this.isConnected()?a():this.sendBuffer.push(a)}},{key:"makeRef",value:function(){var e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}},{key:"sendHeartbeat",value:function(){this.isConnected()&&this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.makeRef()})}},{key:"flushSendBuffer",value:function(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(function(e){return e()}),this.sendBuffer=[])}},{key:"onConnMessage",value:function(e){var t=JSON.parse(e.data),r=t.topic,n=t.event,o=t.payload,i=t.ref;this.log("receive",(o.status||"")+" "+r+" "+n+" "+(i&&"("+i+")"||""),o),this.channels.filter(function(e){return e.isMember(r)}).forEach(function(e){return e.trigger(n,o,i)}),this.stateChangeCallbacks.message.forEach(function(e){return e(t)})}}]),e}(),t.LongPoll=function(){function e(t){o(this,e),this.endPoint=null,this.token=null,this.skipHeartbeat=!0,this.onopen=function(){},this.onerror=function(){},this.onmessage=function(){},this.onclose=function(){},this.pollEndpoint=this.normalizeEndpoint(t),this.readyState=s.connecting,this.poll()}return a(e,[{key:"normalizeEndpoint",value:function(e){return e.replace("ws://","http://").replace("wss://","https://").replace(new RegExp("(.*)/"+f.websocket),"$1/"+f.longpoll)}},{key:"endpointURL",value:function(){return y.appendParams(this.pollEndpoint,{token:this.token})}},{key:"closeAndRetry",value:function(){this.close(),this.readyState=s.connecting}},{key:"ontimeout",value:function(){this.onerror("timeout"),this.closeAndRetry()}},{key:"poll",value:function(){var e=this;this.readyState!==s.open&&this.readyState!==s.connecting||y.request("GET",this.endpointURL(),"application/json",null,this.timeout,this.ontimeout.bind(this),function(t){if(t){var r=t.status,n=t.token,o=t.messages;e.token=n}else var r=0;switch(r){case 200:o.forEach(function(t){return e.onmessage({data:JSON.stringify(t)})}),e.poll();break;case 204:e.poll();break;case 410:e.readyState=s.open,e.onopen(),e.poll();break;case 0:case 500:e.onerror(),e.closeAndRetry();break;default:throw"unhandled poll status "+r}})}},{key:"send",value:function(e){var t=this;y.request("POST",this.endpointURL(),"application/json",e,this.timeout,this.onerror.bind(this,"timeout"),function(e){e&&200===e.status||(t.onerror(status),t.closeAndRetry())})}},{key:"close",value:function(e,t){this.readyState=s.closed,this.onclose()}}]),e}()),y=t.Ajax=function(){function e(){o(this,e)}return a(e,null,[{key:"request",value:function(e,t,r,n,o,i,a){if(window.XDomainRequest){var s=new XDomainRequest;this.xdomainRequest(s,e,t,n,o,i,a)}else{var u=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");this.xhrRequest(u,e,t,r,n,o,i,a)}}},{key:"xdomainRequest",value:function(e,t,r,n,o,i,a){var s=this;e.timeout=o,e.open(t,r),e.onload=function(){var t=s.parseJSON(e.responseText);a&&a(t)},i&&(e.ontimeout=i),e.onprogress=function(){},e.send(n)}},{key:"xhrRequest",value:function(e,t,r,n,o,i,a,s){var u=this;e.timeout=i,e.open(t,r,!0),e.setRequestHeader("Content-Type",n),e.onerror=function(){s&&s(null)},e.onreadystatechange=function(){if(e.readyState===u.states.complete&&s){var t=u.parseJSON(e.responseText);s(t)}},a&&(e.ontimeout=a),e.send(o)}},{key:"parseJSON",value:function(e){return e&&""!==e?JSON.parse(e):null}},{key:"serialize",value:function(e,t){var r=[];for(var n in e)if(e.hasOwnProperty(n)){var o=t?t+"["+n+"]":n,a=e[n];"object"===(void 0===a?"undefined":i(a))?r.push(this.serialize(a,o)):r.push(encodeURIComponent(o)+"="+encodeURIComponent(a))}return r.join("&")}},{key:"appendParams",value:function(e,t){return 0===Object.keys(t).length?e:e+(e.match(/\?/)?"&":"?")+this.serialize(t)}}]),e}();y.states={complete:4};var m=(t.Presence={syncState:function(e,t,r,n){var o=this,i=this.clone(e),a={},s={};return this.map(i,function(e,r){t[e]||(s[e]=r)}),this.map(t,function(e,t){var r=i[e];if(r){var n=t.metas.map(function(e){return e.phx_ref}),u=r.metas.map(function(e){return e.phx_ref}),c=t.metas.filter(function(e){return u.indexOf(e.phx_ref)<0}),l=r.metas.filter(function(e){return n.indexOf(e.phx_ref)<0});c.length>0&&(a[e]=t,a[e].metas=c),l.length>0&&(s[e]=o.clone(r),s[e].metas=l)}else a[e]=t}),this.syncDiff(i,{joins:a,leaves:s},r,n)},syncDiff:function(e,t,r,o){var i=t.joins,a=t.leaves,s=this.clone(e);return r||(r=function(){}),o||(o=function(){}),this.map(i,function(e,t){var o=s[e];if(s[e]=t,o){var i;(i=s[e].metas).unshift.apply(i,n(o.metas))}r(e,o,t)}),this.map(a,function(e,t){var r=s[e];if(r){var n=t.metas.map(function(e){return e.phx_ref});r.metas=r.metas.filter(function(e){return n.indexOf(e.phx_ref)<0}),o(e,r,t),0===r.metas.length&&delete s[e]}}),s},list:function(e,t){return t||(t=function(e,t){return t}),this.map(e,function(e,r){return t(e,r)})},map:function(e,t){return Object.getOwnPropertyNames(e).map(function(r){return t(r,e[r])})},clone:function(e){return JSON.parse(JSON.stringify(e))}},function(){function e(t,r){o(this,e),this.callback=t,this.timerCalc=r,this.timer=null,this.tries=0}return a(e,[{key:"reset",value:function(){this.tries=0,clearTimeout(this.timer)}},{key:"scheduleTimeout",value:function(){var e=this;clearTimeout(this.timer),this.timer=setTimeout(function(){e.tries=e.tries+1,e.callback()},this.timerCalc(this.tries+1))}}]),e}())},function(e,t){function r(e,t){function r(){e.Request.apply(this,arguments)}r.prototype=Object.create(e.Request.prototype),r.prototype.end=function(r){var n=e.Request.prototype.end,o=this;return new t(function(e,t){n.call(o,function(n,o){r&&r(n,o),n?(n.response=o,t(n)):e(o)})})},r.prototype.then=function(r,n){var o=e.Request.prototype.end,i=this;return new t(function(e,t){o.call(i,function(r,n){r?(r.response=n,t(r)):e(n)})}).then(r,n)};var n=function(e,t){return new r(e,t)};return n.options=function(e){return n("OPTIONS",e)},n.head=function(e,t){var r=n("HEAD",e);return t&&r.send(t),r},n.get=function(e,t){var r=n("GET",e);return t&&r.query(t),r},n.post=function(e,t){var r=n("POST",e);return t&&r.send(t),r},n.put=function(e,t){var r=n("PUT",e);return t&&r.send(t),r},n.patch=function(e,t){var r=n("PATCH",e);return t&&r.send(t),r},n.del=function(e){return n("DELETE",e)},n}e.exports=r},function(e,t,r){function n(){}function o(e){if(!y(e))return e;var t=[];for(var r in e)i(t,r,e[r]);return t.join("&")}function i(e,t,r){if(null!=r)if(Array.isArray(r))r.forEach(function(r){i(e,t,r)});else if(y(r))for(var n in r)i(e,t+"["+n+"]",r[n]);else e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));else null===r&&e.push(encodeURIComponent(t))}function a(e){for(var t,r,n={},o=e.split("&"),i=0,a=o.length;i<a;++i)t=o[i],r=t.indexOf("="),-1==r?n[decodeURIComponent(t)]="":n[decodeURIComponent(t.slice(0,r))]=decodeURIComponent(t.slice(r+1));return n}function s(e){for(var t,r,n,o,i=e.split(/\r?\n/),a={},s=0,u=i.length;s<u;++s)r=i[s],-1!==(t=r.indexOf(":"))&&(n=r.slice(0,t).toLowerCase(),o=b(r.slice(t+1)),a[n]=o);return a}function u(e){return/[\/+]json($|[^-\w])/.test(e)}function c(e){this.req=e,this.xhr=this.req.xhr,this.text="HEAD"!=this.req.method&&(""===this.xhr.responseType||"text"===this.xhr.responseType)||void 0===this.xhr.responseType?this.xhr.responseText:null,this.statusText=this.req.xhr.statusText;var t=this.xhr.status;1223===t&&(t=204),this._setStatusProperties(t),this.header=this.headers=s(this.xhr.getAllResponseHeaders()),this.header["content-type"]=this.xhr.getResponseHeader("content-type"),this._setHeaderProperties(this.header),null===this.text&&e._responseType?this.body=this.xhr.response:this.body="HEAD"!=this.req.method?this._parseBody(this.text?this.text:this.xhr.response):null}function l(e,t){var r=this;this._query=this._query||[],this.method=e,this.url=t,this.header={},this._header={},this.on("end",function(){var e=null,t=null;try{t=new c(r)}catch(t){return e=new Error("Parser is unable to parse the response"),e.parse=!0,e.original=t,r.xhr?(e.rawResponse=void 0===r.xhr.responseType?r.xhr.responseText:r.xhr.response,e.status=r.xhr.status?r.xhr.status:null,e.statusCode=e.status):(e.rawResponse=null,e.status=null),r.callback(e)}r.emit("response",t);var n;try{r._isResponseOK(t)||(n=new Error(t.statusText||"Unsuccessful HTTP response"))}catch(e){n=e}n?(n.original=e,n.response=t,n.status=t.status,r.callback(n,t)):r.callback(null,t)})}function f(e,t,r){var n=g("DELETE",e);return"function"==typeof t&&(r=t,t=null),t&&n.send(t),r&&n.end(r),n}var h;h="undefined"!=typeof window?window:"undefined"!=typeof self?self:this;var p=r(42),d=r(43),y=r(16),m=r(44),v=r(46),g=t=e.exports=function(e,r){return"function"==typeof r?new t.Request("GET",e).end(r):1==arguments.length?new t.Request("GET",e):new t.Request(e,r)};t.Request=l,g.getXHR=function(){if(!(!h.XMLHttpRequest||h.location&&"file:"==h.location.protocol&&h.ActiveXObject))return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}throw Error("Browser-only version of superagent could not find XHR")};var b="".trim?function(e){return e.trim()}:function(e){return e.replace(/(^\s*|\s*$)/g,"")};g.serializeObject=o,g.parseString=a,g.types={html:"text/html",json:"application/json",xml:"text/xml",urlencoded:"application/x-www-form-urlencoded",form:"application/x-www-form-urlencoded","form-data":"application/x-www-form-urlencoded"},g.serialize={"application/x-www-form-urlencoded":o,"application/json":JSON.stringify},g.parse={"application/x-www-form-urlencoded":a,"application/json":JSON.parse},m(c.prototype),c.prototype._parseBody=function(e){var t=g.parse[this.type];return this.req._parser?this.req._parser(this,e):(!t&&u(this.type)&&(t=g.parse["application/json"]),t&&e&&(e.length||e instanceof Object)?t(e):null)},c.prototype.toError=function(){var e=this.req,t=e.method,r=e.url,n="cannot "+t+" "+r+" ("+this.status+")",o=new Error(n);return o.status=this.status,o.method=t,o.url=r,o},g.Response=c,p(l.prototype),d(l.prototype),l.prototype.type=function(e){return this.set("Content-Type",g.types[e]||e),this},l.prototype.accept=function(e){return this.set("Accept",g.types[e]||e),this},l.prototype.auth=function(e,t,r){1===arguments.length&&(t=""),"object"==typeof t&&null!==t&&(r=t,t=""),r||(r={type:"function"==typeof btoa?"basic":"auto"});var n=function(e){if("function"==typeof btoa)return btoa(e);throw new Error("Cannot use basic auth, btoa is not a function")};return this._auth(e,t,r,n)},l.prototype.query=function(e){return"string"!=typeof e&&(e=o(e)),e&&this._query.push(e),this},l.prototype.attach=function(e,t,r){if(t){if(this._data)throw Error("superagent can't mix .send() and .attach()");this._getFormData().append(e,t,r||t.name)}return this},l.prototype._getFormData=function(){return this._formData||(this._formData=new h.FormData),this._formData},l.prototype.callback=function(e,t){if(this._shouldRetry(e,t))return this._retry();var r=this._callback;this.clearTimeout(),e&&(this._maxRetries&&(e.retries=this._retries-1),this.emit("error",e)),r(e,t)},l.prototype.crossDomainError=function(){var e=new Error("Request has been terminated\nPossible causes: the network is offline, Origin is not allowed by Access-Control-Allow-Origin, the page is being unloaded, etc.");e.crossDomain=!0,e.status=this.status,e.method=this.method,e.url=this.url,this.callback(e)},l.prototype.buffer=l.prototype.ca=l.prototype.agent=function(){return this},l.prototype.pipe=l.prototype.write=function(){throw Error("Streaming is not supported in browser version of superagent")},l.prototype._isHost=function(e){return e&&"object"==typeof e&&!Array.isArray(e)&&"[object Object]"!==Object.prototype.toString.call(e)},l.prototype.end=function(e){return this._endCalled,this._endCalled=!0,this._callback=e||n,this._finalizeQueryString(),this._end()},l.prototype._end=function(){var e=this,t=this.xhr=g.getXHR(),r=this._formData||this._data;this._setTimeouts(),t.onreadystatechange=function(){var r=t.readyState;if(r>=2&&e._responseTimeoutTimer&&clearTimeout(e._responseTimeoutTimer),4==r){var n;try{n=t.status}catch(e){n=0}if(!n){if(e.timedout||e._aborted)return;return e.crossDomainError()}e.emit("end")}};var n=function(t,r){r.total>0&&(r.percent=r.loaded/r.total*100),r.direction=t,e.emit("progress",r)};if(this.hasListeners("progress"))try{t.onprogress=n.bind(null,"download"),t.upload&&(t.upload.onprogress=n.bind(null,"upload"))}catch(e){}try{this.username&&this.password?t.open(this.method,this.url,!0,this.username,this.password):t.open(this.method,this.url,!0)}catch(e){return this.callback(e)}if(this._withCredentials&&(t.withCredentials=!0),!this._formData&&"GET"!=this.method&&"HEAD"!=this.method&&"string"!=typeof r&&!this._isHost(r)){var o=this._header["content-type"],i=this._serializer||g.serialize[o?o.split(";")[0]:""];!i&&u(o)&&(i=g.serialize["application/json"]),i&&(r=i(r))}for(var a in this.header)null!=this.header[a]&&this.header.hasOwnProperty(a)&&t.setRequestHeader(a,this.header[a]);return this._responseType&&(t.responseType=this._responseType),this.emit("request",this),t.send(void 0!==r?r:null),this},g.agent=function(){return new v},["GET","POST","OPTIONS","PATCH","PUT","DELETE"].forEach(function(e){v.prototype[e.toLowerCase()]=function(t,r){var n=new g.Request(e,t);return this._setDefaults(n),r&&n.end(r),n}}),v.prototype.del=v.prototype.delete,g.get=function(e,t,r){var n=g("GET",e);return"function"==typeof t&&(r=t,t=null),t&&n.query(t),r&&n.end(r),n},g.head=function(e,t,r){var n=g("HEAD",e);return"function"==typeof t&&(r=t,t=null),t&&n.query(t),r&&n.end(r),n},g.options=function(e,t,r){var n=g("OPTIONS",e);return"function"==typeof t&&(r=t,t=null),t&&n.send(t),r&&n.end(r),n},g.del=f,g.delete=f,g.patch=function(e,t,r){var n=g("PATCH",e);return"function"==typeof t&&(r=t,t=null),t&&n.send(t),r&&n.end(r),n},g.post=function(e,t,r){var n=g("POST",e);return"function"==typeof t&&(r=t,t=null),t&&n.send(t),r&&n.end(r),n},g.put=function(e,t,r){var n=g("PUT",e);return"function"==typeof t&&(r=t,t=null),t&&n.send(t),r&&n.end(r),n}},function(e,t,r){function n(e){if(e)return o(e)}function o(e){for(var t in n.prototype)e[t]=n.prototype[t];return e}e.exports=n,n.prototype.on=n.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},n.prototype.once=function(e,t){function r(){this.off(e,r),t.apply(this,arguments)}return r.fn=t,this.on(e,r),this},n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r=this._callbacks["$"+e];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var n,o=0;o<r.length;o++)if((n=r[o])===t||n.fn===t){r.splice(o,1);break}return this},n.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),r=this._callbacks["$"+e];if(r){r=r.slice(0);for(var n=0,o=r.length;n<o;++n)r[n].apply(this,t)}return this},n.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},n.prototype.hasListeners=function(e){return!!this.listeners(e).length}},function(e,t,r){"use strict";function n(e){if(e)return o(e)}function o(e){for(var t in n.prototype)e[t]=n.prototype[t];return e}var i=r(16);e.exports=n,n.prototype.clearTimeout=function(){return clearTimeout(this._timer),clearTimeout(this._responseTimeoutTimer),delete this._timer,delete this._responseTimeoutTimer,this},n.prototype.parse=function(e){return this._parser=e,this},n.prototype.responseType=function(e){return this._responseType=e,this},n.prototype.serialize=function(e){return this._serializer=e,this},n.prototype.timeout=function(e){if(!e||"object"!=typeof e)return this._timeout=e,this._responseTimeout=0,this;for(var t in e)switch(t){case"deadline":this._timeout=e.deadline;break;case"response":this._responseTimeout=e.response}return this},n.prototype.retry=function(e,t){return 0!==arguments.length&&!0!==e||(e=1),e<=0&&(e=0),this._maxRetries=e,this._retries=0,this._retryCallback=t,this};var a=["ECONNRESET","ETIMEDOUT","EADDRINFO","ESOCKETTIMEDOUT"];n.prototype._shouldRetry=function(e,t){if(!this._maxRetries||this._retries++>=this._maxRetries)return!1;if(this._retryCallback)try{var r=this._retryCallback(e,t);if(!0===r)return!0;if(!1===r)return!1}catch(e){}if(t&&t.status&&t.status>=500&&501!=t.status)return!0;if(e){if(e.code&&~a.indexOf(e.code))return!0;if(e.timeout&&"ECONNABORTED"==e.code)return!0;if(e.crossDomain)return!0}return!1},n.prototype._retry=function(){return this.clearTimeout(),this.req&&(this.req=null,this.req=this.request()),this._aborted=!1,this.timedout=!1,this._end()},n.prototype.then=function(e,t){if(!this._fullfilledPromise){var r=this;this._endCalled,this._fullfilledPromise=new Promise(function(e,t){r.end(function(r,n){r?t(r):e(n)})})}return this._fullfilledPromise.then(e,t)},n.prototype.catch=function(e){return this.then(void 0,e)},n.prototype.use=function(e){return e(this),this},n.prototype.ok=function(e){if("function"!=typeof e)throw Error("Callback required");return this._okCallback=e,this},n.prototype._isResponseOK=function(e){return!!e&&(this._okCallback?this._okCallback(e):e.status>=200&&e.status<300)},n.prototype.get=function(e){return this._header[e.toLowerCase()]},n.prototype.getHeader=n.prototype.get,n.prototype.set=function(e,t){if(i(e)){for(var r in e)this.set(r,e[r]);return this}return this._header[e.toLowerCase()]=t,this.header[e]=t,this},n.prototype.unset=function(e){return delete this._header[e.toLowerCase()],delete this.header[e],this},n.prototype.field=function(e,t){if(null===e||void 0===e)throw new Error(".field(name, val) name can not be empty");if(this._data,i(e)){for(var r in e)this.field(r,e[r]);return this}if(Array.isArray(t)){for(var n in t)this.field(e,t[n]);return this}if(null===t||void 0===t)throw new Error(".field(name, val) val can not be empty");return"boolean"==typeof t&&(t=""+t),this._getFormData().append(e,t),this},n.prototype.abort=function(){return this._aborted?this:(this._aborted=!0,this.xhr&&this.xhr.abort(),this.req&&this.req.abort(),this.clearTimeout(),this.emit("abort"),this)},n.prototype._auth=function(e,t,r,n){switch(r.type){case"basic":this.set("Authorization","Basic "+n(e+":"+t));break;case"auto":this.username=e,this.password=t;break;case"bearer":this.set("Authorization","Bearer "+e)}return this},n.prototype.withCredentials=function(e){return void 0==e&&(e=!0),this._withCredentials=e,this},n.prototype.redirects=function(e){return this._maxRedirects=e,this},n.prototype.maxResponseSize=function(e){if("number"!=typeof e)throw TypeError("Invalid argument");return this._maxResponseSize=e,this},n.prototype.toJSON=function(){return{method:this.method,url:this.url,data:this._data,headers:this._header}},n.prototype.send=function(e){var t=i(e),r=this._header["content-type"];if(this._formData,t&&!this._data)Array.isArray(e)?this._data=[]:this._isHost(e)||(this._data={});else if(e&&this._data&&this._isHost(this._data))throw Error("Can't merge these send calls");if(t&&i(this._data))for(var n in e)this._data[n]=e[n];else"string"==typeof e?(r||this.type("form"),r=this._header["content-type"],this._data="application/x-www-form-urlencoded"==r?this._data?this._data+"&"+e:e:(this._data||"")+e):this._data=e;return!t||this._isHost(e)?this:(r||this.type("json"),this)},n.prototype.sortQuery=function(e){return this._sort=void 0===e||e,this},n.prototype._finalizeQueryString=function(){var e=this._query.join("&");if(e&&(this.url+=(this.url.indexOf("?")>=0?"&":"?")+e),this._query.length=0,this._sort){var t=this.url.indexOf("?");if(t>=0){var r=this.url.substring(t+1).split("&");"function"==typeof this._sort?r.sort(this._sort):r.sort(),this.url=this.url.substring(0,t)+"?"+r.join("&")}}},n.prototype._appendQueryString=function(){},n.prototype._timeoutError=function(e,t,r){if(!this._aborted){var n=new Error(e+t+"ms exceeded");n.timeout=t,n.code="ECONNABORTED",n.errno=r,this.timedout=!0,this.abort(),this.callback(n)}},n.prototype._setTimeouts=function(){var e=this;this._timeout&&!this._timer&&(this._timer=setTimeout(function(){e._timeoutError("Timeout of ",e._timeout,"ETIME")},this._timeout)),this._responseTimeout&&!this._responseTimeoutTimer&&(this._responseTimeoutTimer=setTimeout(function(){e._timeoutError("Response timeout of ",e._responseTimeout,"ETIMEDOUT")},this._responseTimeout))}},function(e,t,r){"use strict";function n(e){if(e)return o(e)}function o(e){for(var t in n.prototype)e[t]=n.prototype[t];return e}var i=r(45);e.exports=n,n.prototype.get=function(e){return this.header[e.toLowerCase()]},n.prototype._setHeaderProperties=function(e){var t=e["content-type"]||"";this.type=i.type(t);var r=i.params(t);for(var n in r)this[n]=r[n];this.links={};try{e.link&&(this.links=i.parseLinks(e.link))}catch(e){}},n.prototype._setStatusProperties=function(e){var t=e/100|0;this.status=this.statusCode=e,this.statusType=t,this.info=1==t,this.ok=2==t,this.redirect=3==t,this.clientError=4==t,this.serverError=5==t,this.error=(4==t||5==t)&&this.toError(),this.created=201==e,this.accepted=202==e,this.noContent=204==e,this.badRequest=400==e,this.unauthorized=401==e,this.notAcceptable=406==e,this.forbidden=403==e,this.notFound=404==e,this.unprocessableEntity=422==e}},function(e,t,r){"use strict";t.type=function(e){return e.split(/ *; */).shift()},t.params=function(e){return e.split(/ *; */).reduce(function(e,t){var r=t.split(/ *= */),n=r.shift(),o=r.shift();return n&&o&&(e[n]=o),e},{})},t.parseLinks=function(e){return e.split(/ *, */).reduce(function(e,t){var r=t.split(/ *; */),n=r[0].slice(1,-1);return e[r[1].split(/ *= */)[1].slice(1,-1)]=n,e},{})},t.cleanHeader=function(e,t){return delete e["content-type"],delete e["content-length"],delete e["transfer-encoding"],delete e.host,t&&(delete e.authorization,delete e.cookie),e}},function(e,t){function r(){this._defaults=[]}["use","on","once","set","query","type","accept","auth","withCredentials","sortQuery","retry","ok","redirects","timeout","buffer","serialize","parse","ca","key","pfx","cert"].forEach(function(e){r.prototype[e]=function(){return this._defaults.push({fn:e,arguments:arguments}),this}}),r.prototype._setDefaults=function(e){this._defaults.forEach(function(t){e[t.fn].apply(e,t.arguments)})},e.exports=r},function(e,t,r){function n(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){o(e,t,r[t])})}return e}function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t,r){return t&&a(e.prototype,t),r&&a(e,r),e}function u(e){return f(e)||l(e)||c()}function c(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function l(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function f(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}var h=r(0).Validator,p=r(48),d=r(49),y=r(50),m=r(51),v=r(1),g=v.BufferActionSchema,b=v.ChangeVisibilityActionSchema,w=v.PlayerActionSchema,E=v.TrackerModuleSchema,_=v.UserChangeActionSchema,S=v.UserSchema,T={},O="",A=null,k=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(e){return t.reduce(function(e,t){return t(e)},e)}},j=function(e,t){var r=new h,n={valid:null,errors:null};switch(e){case"buffer":n=r.validate(t,g);break;case"player":n=r.validate(t,w);break;case"change_visibility":n=r.validate(t,b);break;case"user_change":n=r.validate(t,_);break;default:throw new Error("Check action: ".concat(e,", not exist"))}if(!n.valid)throw new Error(n.errors)},P=function(e){if(void 0!==window.document.cloneNode){var t=window.document.cloneNode(!0),r=new d(m,t,{}),n=r.parse();if(!n)return e(new Error("No article"),null);var o=window.document.body.querySelectorAll(O),i=Object.keys(o).filter(function(e){return o[e].innerText&&o[e].innerText.indexOf(n.title)>-1}).map(function(e){return o[e]}).filter(function(e){return e.nodeName===O.toUpperCase()})[0];if(!i)return e(new Error("Don't find the main article"),null);p.count(i,function(t){return e(null,{article:i,message:t})})}},C=function(e){return{body:{screen:T,status:document[e]?"HIDDEN":"VISIBLE",time:{navigation:Math.round(performance.now()/1e3)}}}},x=function(e){return{action:"BEAT",mediaId:e.id.toString(),media_type:e.mediatype,time:{navigation:Math.round(performance.now()/1e3),current_time:Math.round(e.currentTime||""),total_time:Math.round(e.totalTime||"")}}},I=function(e){return{action:e.action.toUpperCase(),mediaId:e.id.toString(),media_type:e.mediatype,screen:T,time:{total_time:Math.round(e.totalTime||""),navigation:Math.round(performance.now()/1e3),current_time:Math.round(e.currentTime||"")},tags:[]}},N=function(e){var t=e.user,r=e.state;return{uid:t.getUserId(),sid:t.getSessionId(),screen:T,time:{navigation:Math.round(performance.now()/1e3)},tags:[{state:r}]}},R=function(e){var t=e.action,r=e.tags;return{action:t,screen:T,time:{navigation:Math.round(performance.now()/1e3)},tags:r}},D=function(e){return{action:"BUFFER",mediaId:e.id.toString(),media_type:e.mediatype,screen:T,time:{total_time:Math.round(e.totalTime||""),navigation:Math.round(performance.now()/1e3),current_time:Math.round(e.currentTime||"")},tags:[{oldState:e.oldstate},{newState:e.newstate},{reason:e.reason}]}},M=function(e){return function(t){var r={adClick:function(e,t){var r=t.tag.link;return e.tags=u(e.tags).concat([{rmb:r}]),e},mute:function(e,t){var r=t.tag.mute;return e.tags=u(e.tags).concat([{mute:r}]),e}};return r[e.action]?r[e.action](t,e):t}},$=function(e){var t=e.position,r=e.message;return{action:"SCROLL",screen:T,time:{navigation:Math.round(performance.now()/1e3)},tags:[{viewport:t.viewport},{page:{width:t.elem.width,height:t.elem.height}},{position:{offset:t.offset,bottom:t.elem.bottom,top:t.elem.top}},{message:{sentences:r.sentences,words:r.words}}]}},L=function(e){return y.position(e)},U=function(){return void 0!==document.hidden?{hidden:"hidden",visibilityChange:"visibilitychange",visibilityState:"visibilityState"}:void 0!==document.mozHidden?{hidden:"mozHidden",visibilityChange:"mozvisibilitychange",visibilityState:"mozVisibilityState"}:void 0!==document.msHidden?{hidden:"msHidden",visibilityChange:"msvisibilitychange",visibilityState:"msVisibilityState"}:void 0!==document.webkitHidden?{hidden:"webkitHidden",visibilityChange:"webkitvisibilitychange",visibilityState:"webkitVisibilityState"}:{hidden:"",visibilityChange:"",visibilityState:""}},F=function(){function e(t){if(i(this,e),!t)throw new Error("The object passed as parameter cannot be empty");var r=new h,n=r.validate(t,S);if(!n.valid)throw new Error(n.errors);this.user=t,this.hidden=null,this.state={},this.init()}return s(e,[{key:"init",value:function(){(!T.path||!T.type&&T.id||T.type&&!T.id)&&(T={path:null,id:null,type:null}),this.connectionAction();var e=U(),t=e.hidden,r=e.visibilityChange,n=e.visibilityState;this.hidden=t,this.visibility=r,this.visibilityState=n,this._contextListener()}},{key:"_contextListener",value:function(){var e=this,t=this;void 0!==window.document.addEventListener&&void 0!==window.document[this.hidden]&&window.document.addEventListener(this.visibilityChange,function(){document[e.hidden]?e.visibilityAction("BLUR"):e.visibilityAction("FOCUS")},!1),P(function(e,r){if(!e){var n=r.message,o=r.article,i=L(o),a=null;t.scrollAction(i,n),window.addEventListener("scroll",function(){null!==a&&clearTimeout(a),a=setTimeout(function(){t.scrollAction(i,n)},1e3)},!1)}})}},{key:"sendMessage",value:function(e){return function(t){return A(e,t)}}},{key:"connectionAction",value:function(){k(C,this.sendMessage("connection"))(this.hidden)}},{key:"userChangeAction",value:function(e,t){var r=e.uid,n=e.sid;j("user_change",{uid:r,sid:n,userChangeAction:t}),this.state.userChangeAction!==t&&(this.state.userChangeAction=t,this.user.setParams({userId:r,sessionId:n}),k(N,this.sendMessage("user_change"))({user:this.user,state:t}))}},{key:"playerAction",value:function(e){j("player",e);var t=I(e);switch(e.action){case"seeking":k(M(e),this.sendMessage("player"))(n({},t,{action:"SEEKING"})),k(M(e),this.sendMessage("player"))(n({},t,{action:"SEEKED",time:n({},t.time,{currentTime:e.seekTo})}));break;default:k(M(e),this.sendMessage("player"))(t)}}},{key:"bufferAction",value:function(e){j("buffer",e),k(D,this.sendMessage("player"))(e)}},{key:"beatAction",value:function(e){j("player",e),k(x,this.sendMessage("beat"))(e)}},{key:"visibilityAction",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];j("change_visibility",{action:e,tags:t}),this.state.visibilityAction!==e&&(this.state.visibilityAction=e,k(R,this.sendMessage("change_visibility"))({action:e,tags:t}))}},{key:"scrollAction",value:function(e,t){k($,this.sendMessage("scroll"))({position:e,message:t})}},{key:"visibilityChange",get:function(){return this.visibility}}]),e}();e.exports=function(e,t){if(!t||!e)throw new Error("sender or context is not defined");var r=new h,n=r.validate(e,E);if(!n.valid)throw new Error(n.errors);if("function"!=typeof t)throw new Error("pSender should to be a function");return A=t,T=e.screen,O=e.articleTag,F}},function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e){for(var t=[],r=0,n=e.length;r<n;){var o=e.charCodeAt(r++);if(o>=55296&&o<=56319&&r<n){var i=e.charCodeAt(r++);56320==(64512&i)?t.push(((1023&o)<<10)+(1023&i)+65536):(t.push(o),r--)}else t.push(o)}return t}function i(e,t){var r=Object.prototype.toString.call(e),n="[object NodeList]"===r||"[object HTMLCollection]"===r||1===e.nodeType,o="function"==typeof t;return n&&o}function a(e,t){var r=""+("value"in e?e.value:e.textContent);t=t||{},t.stripTags&&(r=r.replace(/<\/?[a-z][^>]*>/gi,"")),t.ignore&&u.call(t.ignore,function(e){r=r.replace(e,"")});var n=r.trim();return{paragraphs:n?(n.match(t.hardReturns?/\n{2,}/g:/\n+/g)||[]).length+1:0,sentences:n?(n.match(/[.?!…]+./g)||[]).length+1:0,words:n?(n.replace(/['";:,.?¿\-!¡]+/g,"").match(/\S+/g)||[]).length:0,characters:n?o(n.replace(/\s/g,"")).length:0,all:o(r).length}}var s=[],u=Array.prototype.forEach,c={on:function(e,t,r){if(i(e,t))return void 0===e.length&&(e=[e]),u.call(e,function(e){var n=function(){t.call(e,a(e,r))};s.push({element:e,handler:n}),n(),e.addEventListener("input",n)}),this},off:function(e){if(i(e,function(){}))return void 0===e.length&&(e=[e]),s.filter(function(t){return-1!==e.indexOf(t.element)}).forEach(function(e){e.element.removeEventListener("input",e.handler)}),s=s.filter(function(t){return-1===e.indexOf(t.element)}),this},count:function(e,t,r){if(i(e,t))return void 0===e.length&&(e=[e]),u.call(e,function(e){t.call(e,a(e,r))}),this},enabled:function(e){return void 0===e.length&&(e=[e]),s.filter(function(t){return-1!==e.indexOf(t.element)}).length===e.length}};"object"===n(t)&&(e.exports=c)},function(e,t,r){(function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t,r){r=r||{},this._uri=e,this._doc=t,this._articleTitle=null,this._articleByline=null,this._articleDir=null,this._attempts=[],this._debug=!!r.debug,this._maxElemsToParse=r.maxElemsToParse||this.DEFAULT_MAX_ELEMS_TO_PARSE,this._nbTopCandidates=r.nbTopCandidates||this.DEFAULT_N_TOP_CANDIDATES,this._wordThreshold=r.wordThreshold||this.DEFAULT_WORD_THRESHOLD,this._classesToPreserve=this.CLASSES_TO_PRESERVE.concat(r.classesToPreserve||[]),this._flags=this.FLAG_STRIP_UNLIKELYS|this.FLAG_WEIGHT_CLASSES|this.FLAG_CLEAN_CONDITIONALLY;var n;this._debug?(n=function(e){var t=e.nodeName+" ";if(e.nodeType==e.TEXT_NODE)return t+'("'+e.textContent+'")';var r=e.className&&"."+e.className.replace(/ /g,"."),n="";return e.id?n="(#"+e.id+r+")":r&&(n="("+r+")"),t+n},this.log=function(){if("undefined"!=typeof dump){var e=Array.prototype.map.call(arguments,function(e){return e&&e.nodeName?n(e):e}).join(" ");dump("Reader: (Readability) "+e+"\n")}else"undefined"!=typeof console&&["Reader: (Readability) "].concat(arguments)}):this.log=function(){}}r.prototype={FLAG_STRIP_UNLIKELYS:1,FLAG_WEIGHT_CLASSES:2,FLAG_CLEAN_CONDITIONALLY:4,DEFAULT_MAX_ELEMS_TO_PARSE:0,DEFAULT_N_TOP_CANDIDATES:5,DEFAULT_TAGS_TO_SCORE:"section,h2,h3,h4,h5,h6,p,td,pre".toUpperCase().split(","),DEFAULT_WORD_THRESHOLD:500,REGEXPS:{unlikelyCandidates:/banner|breadcrumbs|combx|comment|community|cover-wrap|disqus|extra|foot|header|legends|menu|related|remark|replies|rss|shoutbox|sidebar|skyscraper|social|sponsor|supplemental|ad-break|agegate|pagination|pager|popup|yom-remote/i,okMaybeItsACandidate:/and|article|body|column|main|shadow/i,positive:/article|body|content|entry|hentry|h-entry|main|page|pagination|post|text|blog|story/i,negative:/hidden|^hid$| hid$| hid |^hid |banner|combx|comment|com-|contact|foot|footer|footnote|masthead|media|meta|outbrain|promo|related|scroll|share|shoutbox|sidebar|skyscraper|sponsor|shopping|tags|tool|widget/i,extraneous:/print|archive|comment|discuss|e[\-]?mail|share|reply|all|login|sign|single|utility/i,byline:/byline|author|dateline|writtenby|p-author/i,replaceFonts:/<(\/?)font[^>]*>/gi,normalize:/\s{2,}/g,videos:/\/\/(www\.)?(dailymotion|youtube|youtube-nocookie|player\.vimeo)\.com/i,nextLink:/(next|weiter|continue|>([^\|]|$)|»([^\|]|$))/i,prevLink:/(prev|earl|old|new|<|«)/i,whitespace:/^\s*$/,hasContent:/\S$/},DIV_TO_P_ELEMS:["A","BLOCKQUOTE","DL","DIV","IMG","OL","P","PRE","TABLE","UL","SELECT"],ALTER_TO_DIV_EXCEPTIONS:["DIV","ARTICLE","SECTION","P"],PRESENTATIONAL_ATTRIBUTES:["align","background","bgcolor","border","cellpadding","cellspacing","frame","hspace","rules","style","valign","vspace"],DEPRECATED_SIZE_ATTRIBUTE_ELEMS:["TABLE","TH","TD","HR","PRE"],CLASSES_TO_PRESERVE:["readability-styled","page"],_postProcessContent:function(e){this._fixRelativeUris(e),this._cleanClasses(e)},_removeNodes:function(e,t){for(var r=e.length-1;r>=0;r--){var n=e[r],o=n.parentNode;o&&(t&&!t.call(this,n,r,e)||o.removeChild(n))}},_replaceNodeTags:function(e,t){for(var r=e.length-1;r>=0;r--){var n=e[r];this._setNodeTag(n,t)}},_forEachNode:function(e,t){Array.prototype.forEach.call(e,t,this)},_someNode:function(e,t){return Array.prototype.some.call(e,t,this)},_concatNodeLists:function(){var e=Array.prototype.slice,t=e.call(arguments),r=t.map(function(t){return e.call(t)});return Array.prototype.concat.apply([],r)},_getAllNodesWithTag:function(e,t){return e.querySelectorAll?e.querySelectorAll(t.join(",")):[].concat.apply([],t.map(function(t){var r=e.getElementsByTagName(t);return Array.isArray(r)?r:Array.from(r)}))},_cleanClasses:function(e){var t=this._classesToPreserve,r=(e.getAttribute("class")||"").split(/\s+/).filter(function(e){return-1!=t.indexOf(e)}).join(" ");for(r?e.setAttribute("class",r):e.removeAttribute("class"),e=e.firstElementChild;e;e=e.nextElementSibling)this._cleanClasses(e)},_fixRelativeUris:function(e){function t(e){if(r==n&&"#"==e.charAt(0))return e;try{return new URL(e,r).href}catch(e){}return e}var r=this._doc.baseURI,n=this._doc.documentURI,o=e.getElementsByTagName("a");this._forEachNode(o,function(e){var r=e.getAttribute("href");if(r)if(0===r.indexOf("javascript:")){var n=this._doc.createTextNode(e.textContent);e.parentNode.replaceChild(n,e)}else e.setAttribute("href",t(r))});var i=e.getElementsByTagName("img");this._forEachNode(i,function(e){var r=e.getAttribute("src");r&&e.setAttribute("src",t(r))})},_getArticleTitle:function(){function e(e){return e.split(/\s+/).length}var t=this._doc,r="",n="";try{"string"!=typeof(r=n=t.title)&&(r=n=this._getInnerText(t.getElementsByTagName("title")[0]))}catch(e){}var o=!1;if(/ [\|\-\\\/>»] /.test(r))o=/ [\\\/>»] /.test(r),r=n.replace(/(.*)[\|\-\\\/>»] .*/gi,"$1"),e(r)<3&&(r=n.replace(/[^\|\-\\\/>»]*[\|\-\\\/>»](.*)/gi,"$1"));else if(-1!==r.indexOf(": ")){var i=this._concatNodeLists(t.getElementsByTagName("h1"),t.getElementsByTagName("h2")),a=this._someNode(i,function(e){return e.textContent===r});a||(r=n.substring(n.lastIndexOf(":")+1),e(r)<3?r=n.substring(n.indexOf(":")+1):e(n.substr(0,n.indexOf(":")))>5&&(r=n))}else if(r.length>150||r.length<15){var s=t.getElementsByTagName("h1");1===s.length&&(r=this._getInnerText(s[0]))}r=r.trim();var u=e(r);return u<=4&&(!o||u!=e(n.replace(/[\|\-\\\/>»]+/g,""))-1)&&(r=n),r},_prepDocument:function(){var e=this._doc;this._removeNodes(e.getElementsByTagName("style")),e.body&&this._replaceBrs(e.body),this._replaceNodeTags(e.getElementsByTagName("font"),"SPAN")},_nextElement:function(e){for(var t=e;t&&t.nodeType!=Node.ELEMENT_NODE&&this.REGEXPS.whitespace.test(t.textContent);)t=t.nextSibling;return t},_replaceBrs:function(e){this._forEachNode(this._getAllNodesWithTag(e,["br"]),function(e){for(var t=e.nextSibling,r=!1;(t=this._nextElement(t))&&"BR"==t.tagName;){r=!0;var n=t.nextSibling;t.parentNode.removeChild(t),t=n}if(r){var o=this._doc.createElement("p");for(e.parentNode.replaceChild(o,e),t=o.nextSibling;t;){if("BR"==t.tagName){var i=this._nextElement(t);if(i&&"BR"==i.tagName)break}var a=t.nextSibling;o.appendChild(t),t=a}}})},_setNodeTag:function(e,t){if(this.log("_setNodeTag",e,t),e.__JSDOMParser__)return e.localName=t.toLowerCase(),e.tagName=t.toUpperCase(),e;for(var r=e.ownerDocument.createElement(t);e.firstChild;)r.appendChild(e.firstChild);e.parentNode.replaceChild(r,e),e.readability&&(r.readability=e.readability);for(var n=0;n<e.attributes.length;n++)r.setAttribute(e.attributes[n].name,e.attributes[n].value);return r},_prepArticle:function(e){this._cleanStyles(e),this._markDataTables(e),this._cleanConditionally(e,"form"),this._cleanConditionally(e,"fieldset"),this._clean(e,"object"),this._clean(e,"embed"),this._clean(e,"h1"),this._clean(e,"footer"),this._clean(e,"link"),this._forEachNode(e.children,function(e){this._cleanMatchedNodes(e,/share/)});var t=e.getElementsByTagName("h2");if(1===t.length){var r=(t[0].textContent.length-this._articleTitle.length)/this._articleTitle.length;if(Math.abs(r)<.5){(r>0?t[0].textContent.indexOf(this._articleTitle)>=0:this._articleTitle.indexOf(t[0].textContent)>=0)&&this._clean(e,"h2")}}this._clean(e,"iframe"),this._clean(e,"input"),this._clean(e,"textarea"),this._clean(e,"select"),this._clean(e,"button"),this._cleanHeaders(e),this._cleanConditionally(e,"table"),this._cleanConditionally(e,"ul"),this._cleanConditionally(e,"div"),this._removeNodes(e.getElementsByTagName("p"),function(e){return 0===e.getElementsByTagName("img").length+e.getElementsByTagName("embed").length+e.getElementsByTagName("object").length+e.getElementsByTagName("iframe").length&&!this._getInnerText(e,!1)}),this._forEachNode(this._getAllNodesWithTag(e,["br"]),function(e){var t=this._nextElement(e.nextSibling);t&&"P"==t.tagName&&e.parentNode.removeChild(e)})},_initializeNode:function(e){switch(e.readability={contentScore:0},e.tagName){case"DIV":e.readability.contentScore+=5;break;case"PRE":case"TD":case"BLOCKQUOTE":e.readability.contentScore+=3;break;case"ADDRESS":case"OL":case"UL":case"DL":case"DD":case"DT":case"LI":case"FORM":e.readability.contentScore-=3;break;case"H1":case"H2":case"H3":case"H4":case"H5":case"H6":case"TH":e.readability.contentScore-=5}e.readability.contentScore+=this._getClassWeight(e)},_removeAndGetNext:function(e){var t=this._getNextNode(e,!0);return e.parentNode.removeChild(e),t},_getNextNode:function(e,t){if(!t&&e.firstElementChild)return e.firstElementChild;if(e.nextElementSibling)return e.nextElementSibling;do{e=e.parentNode}while(e&&!e.nextElementSibling);return e&&e.nextElementSibling},_getNextNodeNoElementProperties:function(e,t){function r(e){do{e=e.nextSibling}while(e&&e.nodeType!==e.ELEMENT_NODE);return e}if(!t&&e.children[0])return e.children[0];var n=r(e);if(n)return n;do{(e=e.parentNode)&&(n=r(e))}while(e&&!n);return e&&n},_checkByline:function(e,t){if(this._articleByline)return!1;if(void 0!==e.getAttribute)var r=e.getAttribute("rel");return!("author"!==r&&!this.REGEXPS.byline.test(t)||!this._isValidByline(e.textContent)||(this._articleByline=e.textContent.trim(),0))},_getNodeAncestors:function(e,t){t=t||0;for(var r=0,n=[];e.parentNode&&(n.push(e.parentNode),!t||++r!==t);)e=e.parentNode;return n},_grabArticle:function(e){this.log("**** grabArticle ****");var t=this._doc,r=null!==e;if(!(e=e||this._doc.body))return this.log("No body found in document. Abort."),null;for(var n=e.innerHTML;;){for(var o=this._flagIsActive(this.FLAG_STRIP_UNLIKELYS),i=[],a=this._doc.documentElement;a;){var s=a.className+" "+a.id;if(this._checkByline(a,s))a=this._removeAndGetNext(a);else if(o&&this.REGEXPS.unlikelyCandidates.test(s)&&!this.REGEXPS.okMaybeItsACandidate.test(s)&&"BODY"!==a.tagName&&"A"!==a.tagName)this.log("Removing unlikely candidate - "+s),a=this._removeAndGetNext(a);else if("DIV"!==a.tagName&&"SECTION"!==a.tagName&&"HEADER"!==a.tagName&&"H1"!==a.tagName&&"H2"!==a.tagName&&"H3"!==a.tagName&&"H4"!==a.tagName&&"H5"!==a.tagName&&"H6"!==a.tagName||!this._isElementWithoutContent(a)){if(-1!==this.DEFAULT_TAGS_TO_SCORE.indexOf(a.tagName)&&i.push(a),"DIV"===a.tagName)if(this._hasSinglePInsideElement(a)){var u=a.children[0];a.parentNode.replaceChild(u,a),a=u,i.push(a)}else this._hasChildBlockElement(a)?this._forEachNode(a.childNodes,function(e){if(e.nodeType===Node.TEXT_NODE&&e.textContent.trim().length>0){var r=t.createElement("p");r.textContent=e.textContent,r.style.display="inline",r.className="readability-styled",a.replaceChild(r,e)}}):(a=this._setNodeTag(a,"P"),i.push(a));a=this._getNextNode(a)}else a=this._removeAndGetNext(a)}var c=[];this._forEachNode(i,function(e){if(e.parentNode&&void 0!==e.parentNode.tagName){var t=this._getInnerText(e);if(!(t.length<25)){var r=this._getNodeAncestors(e,3);if(0!==r.length){var n=0;n+=1,n+=t.split(",").length,n+=Math.min(Math.floor(t.length/100),3),this._forEachNode(r,function(e,t){if(e.tagName){if(void 0===e.readability&&(this._initializeNode(e),c.push(e)),0===t)var r=1;else r=1===t?2:3*t;e.readability.contentScore+=n/r}})}}}});for(var l=[],f=0,h=c.length;f<h;f+=1){var p=c[f],d=p.readability.contentScore*(1-this._getLinkDensity(p));p.readability.contentScore=d,this.log("Candidate:",p,"with score "+d);for(var y=0;y<this._nbTopCandidates;y++){var m=l[y];if(!m||d>m.readability.contentScore){l.splice(y,0,p),l.length>this._nbTopCandidates&&l.pop();break}}}var v,g=l[0]||null,b=!1;if(null===g||"BODY"===g.tagName){g=t.createElement("DIV"),b=!0;for(var w=e.childNodes;w.length;)this.log("Moving child out:",w[0]),g.appendChild(w[0]);e.appendChild(g),this._initializeNode(g)}else if(g){for(var E=[],_=1;_<l.length;_++)l[_].readability.contentScore/g.readability.contentScore>=.75&&E.push(this._getNodeAncestors(l[_]));if(E.length>=3)for(v=g.parentNode;"BODY"!==v.tagName;){for(var S=0,T=0;T<E.length&&S<3;T++)S+=Number(E[T].indexOf(v)>=0);if(S>=3){g=v;break}v=v.parentNode}g.readability||this._initializeNode(g),v=g.parentNode;for(var O=g.readability.contentScore,A=O/3;"BODY"!==v.tagName;)if(v.readability){var k=v.readability.contentScore;if(k<A)break;if(k>O){g=v;break}O=v.readability.contentScore,v=v.parentNode}else v=v.parentNode;for(v=g.parentNode;"BODY"!=v.tagName&&1==v.children.length;)g=v,v=g.parentNode;g.readability||this._initializeNode(g)}var j=t.createElement("DIV");r&&(j.id="readability-content");var P=Math.max(10,.2*g.readability.contentScore);v=g.parentNode;for(var C=v.children,x=0,I=C.length;x<I;x++){var N=C[x],R=!1;if(this.log("Looking at sibling node:",N,N.readability?"with score "+N.readability.contentScore:""),this.log("Sibling has score",N.readability?N.readability.contentScore:"Unknown"),N===g)R=!0;else{var D=0;if(N.className===g.className&&""!==g.className&&(D+=.2*g.readability.contentScore),N.readability&&N.readability.contentScore+D>=P)R=!0;else if("P"===N.nodeName){var M=this._getLinkDensity(N),$=this._getInnerText(N),L=$.length;L>80&&M<.25?R=!0:L<80&&L>0&&0===M&&-1!==$.search(/\.( |$)/)&&(R=!0)}}R&&(this.log("Appending node:",N),-1===this.ALTER_TO_DIV_EXCEPTIONS.indexOf(N.nodeName)&&(this.log("Altering sibling:",N,"to div."),N=this._setNodeTag(N,"DIV")),j.appendChild(N),x-=1,I-=1)}if(this._debug&&this.log("Article content pre-prep: "+j.innerHTML),this._prepArticle(j),this._debug&&this.log("Article content post-prep: "+j.innerHTML),b)g.id="readability-page-1",g.className="page";else{var U=t.createElement("DIV");U.id="readability-page-1",U.className="page";for(var F=j.childNodes;F.length;)U.appendChild(F[0]);j.appendChild(U)}this._debug&&this.log("Article content after paging: "+j.innerHTML);var q=!0,B=this._getInnerText(j,!0).length;if(B<this._wordThreshold)if(q=!1,e.innerHTML=n,this._flagIsActive(this.FLAG_STRIP_UNLIKELYS))this._removeFlag(this.FLAG_STRIP_UNLIKELYS),this._attempts.push({articleContent:j,textLength:B});else if(this._flagIsActive(this.FLAG_WEIGHT_CLASSES))this._removeFlag(this.FLAG_WEIGHT_CLASSES),this._attempts.push({articleContent:j,textLength:B});else if(this._flagIsActive(this.FLAG_CLEAN_CONDITIONALLY))this._removeFlag(this.FLAG_CLEAN_CONDITIONALLY),this._attempts.push({articleContent:j,textLength:B});else{if(this._attempts.push({articleContent:j,textLength:B}),this._attempts.sort(function(e,t){return e.textLength<t.textLength}),!this._attempts[0].textLength)return null;j=this._attempts[0].articleContent,q=!0}if(q){var H=[v,g].concat(this._getNodeAncestors(v));return this._someNode(H,function(e){if(!e.tagName)return!1;var t=e.getAttribute("dir");return!!t&&(this._articleDir=t,!0)}),j}}},_isValidByline:function(e){return("string"==typeof e||e instanceof String)&&(e=e.trim(),e.length>0&&e.length<100)},_getArticleMetadata:function(){var e={},t={},r=this._doc.getElementsByTagName("meta"),n=/^\s*((twitter)\s*:\s*)?(description|title)\s*$/gi,o=/^\s*og\s*:\s*(description|title)\s*$/gi;return this._forEachNode(r,function(r){var i=r.getAttribute("name"),a=r.getAttribute("property");if(-1!==[i,a].indexOf("author"))return void(e.byline=r.getAttribute("content"));var s=null;if(n.test(i)?s=i:o.test(a)&&(s=a),s){var u=r.getAttribute("content");u&&(s=s.toLowerCase().replace(/\s/g,""),t[s]=u.trim())}}),"description"in t?e.excerpt=t.description:"og:description"in t?e.excerpt=t["og:description"]:"twitter:description"in t&&(e.excerpt=t["twitter:description"]),e.title=this._getArticleTitle(),e.title||("og:title"in t?e.title=t["og:title"]:"twitter:title"in t&&(e.title=t["twitter:title"])),e},_removeScripts:function(e){this._removeNodes(e.getElementsByTagName("script"),function(e){return e.nodeValue="",e.removeAttribute("src"),!0}),this._removeNodes(e.getElementsByTagName("noscript"))},_hasSinglePInsideElement:function(e){return 1==e.children.length&&"P"===e.children[0].tagName&&!this._someNode(e.childNodes,function(e){return e.nodeType===Node.TEXT_NODE&&this.REGEXPS.hasContent.test(e.textContent)})},_isElementWithoutContent:function(e){return e.nodeType===Node.ELEMENT_NODE&&0==e.textContent.trim().length&&(0==e.children.length||e.children.length==e.getElementsByTagName("br").length+e.getElementsByTagName("hr").length)},_hasChildBlockElement:function(e){return this._someNode(e.childNodes,function(e){return-1!==this.DIV_TO_P_ELEMS.indexOf(e.tagName)||this._hasChildBlockElement(e)})},_getInnerText:function(e,t){t=void 0===t||t;var r=e.textContent.trim();return t?r.replace(this.REGEXPS.normalize," "):r},_getCharCount:function(e,t){return t=t||",",this._getInnerText(e).split(t).length-1},_cleanStyles:function(e){if(e&&"svg"!==e.tagName.toLowerCase()){if("readability-styled"!==e.className){for(var t=0;t<this.PRESENTATIONAL_ATTRIBUTES.length;t++)e.removeAttribute(this.PRESENTATIONAL_ATTRIBUTES[t]);-1!==this.DEPRECATED_SIZE_ATTRIBUTE_ELEMS.indexOf(e.tagName)&&(e.removeAttribute("width"),e.removeAttribute("height"))}for(var r=e.firstElementChild;null!==r;)this._cleanStyles(r),r=r.nextElementSibling}},_getLinkDensity:function(e){var t=this._getInnerText(e).length;if(0===t)return 0;var r=0;return this._forEachNode(e.getElementsByTagName("a"),function(e){r+=this._getInnerText(e).length}),r/t},_getClassWeight:function(e){if(!this._flagIsActive(this.FLAG_WEIGHT_CLASSES))return 0;var t=0;return"string"==typeof e.className&&""!==e.className&&(this.REGEXPS.negative.test(e.className)&&(t-=25),this.REGEXPS.positive.test(e.className)&&(t+=25)),"string"==typeof e.id&&""!==e.id&&(this.REGEXPS.negative.test(e.id)&&(t-=25),this.REGEXPS.positive.test(e.id)&&(t+=25)),t},_clean:function(e,t){var r=-1!==["object","embed","iframe"].indexOf(t);this._removeNodes(e.getElementsByTagName(t),function(e){if(r){var t=[].map.call(e.attributes,function(e){return e.value}).join("|");if(this.REGEXPS.videos.test(t))return!1;if(this.REGEXPS.videos.test(e.innerHTML))return!1}return!0})},_hasAncestorTag:function(e,t,r,n){r=r||3,t=t.toUpperCase();for(var o=0;e.parentNode;){if(r>0&&o>r)return!1;if(e.parentNode.tagName===t&&(!n||n(e.parentNode)))return!0;e=e.parentNode,o++}return!1},_getRowAndColumnCount:function(e){for(var t=0,r=0,n=e.getElementsByTagName("tr"),o=0;o<n.length;o++){var i=n[o].getAttribute("rowspan")||0;i&&(i=parseInt(i,10)),t+=i||1;for(var a=0,s=n[o].getElementsByTagName("td"),u=0;u<s.length;u++){var c=s[u].getAttribute("colspan")||0;c&&(c=parseInt(c,10)),a+=c||1}r=Math.max(r,a)}return{rows:t,columns:r}},_markDataTables:function(e){for(var t=e.getElementsByTagName("table"),r=0;r<t.length;r++){var n=t[r];if("presentation"!=n.getAttribute("role"))if("0"!=n.getAttribute("datatable"))if(n.getAttribute("summary"))n._readabilityDataTable=!0;else{var o=n.getElementsByTagName("caption")[0];if(o&&o.childNodes.length>0)n._readabilityDataTable=!0;else{var i=["col","colgroup","tfoot","thead","th"],a=function(e){return!!n.getElementsByTagName(e)[0]};if(i.some(a))this.log("Data table because found data-y descendant"),n._readabilityDataTable=!0;else if(n.getElementsByTagName("table")[0])n._readabilityDataTable=!1;else{var s=this._getRowAndColumnCount(n);s.rows>=10||s.columns>4?n._readabilityDataTable=!0:n._readabilityDataTable=s.rows*s.columns>10}}}else n._readabilityDataTable=!1;else n._readabilityDataTable=!1}},_cleanConditionally:function(e,t){if(this._flagIsActive(this.FLAG_CLEAN_CONDITIONALLY)){var r="ul"===t||"ol"===t;this._removeNodes(e.getElementsByTagName(t),function(e){var t=function(e){return e._readabilityDataTable};if(this._hasAncestorTag(e,"table",-1,t))return!1;var n=this._getClassWeight(e);if(this.log("Cleaning Conditionally",e),n+0<0)return!0;if(this._getCharCount(e,",")<10){for(var o=e.getElementsByTagName("p").length,i=e.getElementsByTagName("img").length,a=e.getElementsByTagName("li").length-100,s=e.getElementsByTagName("input").length,u=0,c=e.getElementsByTagName("embed"),l=0,f=c.length;l<f;l+=1)this.REGEXPS.videos.test(c[l].src)||(u+=1);var h=this._getLinkDensity(e),p=this._getInnerText(e).length;return i>1&&o/i<.5&&!this._hasAncestorTag(e,"figure")||!r&&a>o||s>Math.floor(o/3)||!r&&p<25&&(0===i||i>2)&&!this._hasAncestorTag(e,"figure")||!r&&n<25&&h>.2||n>=25&&h>.5||1===u&&p<75||u>1}return!1})}},_cleanMatchedNodes:function(e,t){for(var r=this._getNextNode(e,!0),n=this._getNextNode(e);n&&n!=r;)n=t.test(n.className+" "+n.id)?this._removeAndGetNext(n):this._getNextNode(n)},_cleanHeaders:function(e){for(var t=1;t<3;t+=1)this._removeNodes(e.getElementsByTagName("h"+t),function(e){return this._getClassWeight(e)<0})},_flagIsActive:function(e){return(this._flags&e)>0},_removeFlag:function(e){this._flags=this._flags&~e},isProbablyReaderable:function(e){var t=this._getAllNodesWithTag(this._doc,["p","pre"]),r=this._getAllNodesWithTag(this._doc,["div > br"]);if(r.length){var n=new Set;[].forEach.call(r,function(e){n.add(e.parentNode)}),t=[].concat.apply(Array.from(n),t)}var o=0;return this._someNode(t,function(t){if(e&&!e(t))return!1;var r=t.className+" "+t.id;if(this.REGEXPS.unlikelyCandidates.test(r)&&!this.REGEXPS.okMaybeItsACandidate.test(r))return!1;if(t.matches&&t.matches("li p"))return!1;var n=t.textContent.trim().length;return!(n<140)&&(o+=Math.sqrt(n-140))>20})},parse:function(){if(this._maxElemsToParse>0){var e=this._doc.getElementsByTagName("*").length;if(e>this._maxElemsToParse)throw new Error("Aborting parsing document; "+e+" elements found")}void 0===this._doc.documentElement.firstElementChild&&(this._getNextNode=this._getNextNodeNoElementProperties),this._removeScripts(this._doc),this._prepDocument();var t=this._getArticleMetadata();this._articleTitle=t.title;var r=this._grabArticle();if(!r)return null;if(this.log("Grabbed: "+r.innerHTML),this._postProcessContent(r),!t.excerpt){var n=r.getElementsByTagName("p");n.length>0&&(t.excerpt=n[0].textContent.trim())}var o=r.textContent;return{uri:this._uri,title:this._articleTitle,byline:t.byline||this._articleByline,dir:this._articleDir,content:r.innerHTML,textContent:o,length:o.length,excerpt:t.excerpt}}},"object"===t(e)&&(e.exports=r)}).call(t,r(15)(e))},function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var o={screen:function(){return{width:Math.max(document.documentElement.clientWidth,window.innerWidth||0),height:Math.max(document.documentElement.clientHeight,window.innerHeight||0)}},position:function(e){var t=document.body.getBoundingClientRect(),r=e.getBoundingClientRect();return{offset:r.top-t.top,elem:r,viewport:this.screen()}}};"object"===n(t)&&(e.exports=o)},function(e,t){var r=document.location,n={spec:r.href,host:r.host,prePath:r.protocol+"//"+r.host,scheme:r.protocol.substr(0,r.protocol.indexOf(":")),pathBase:r.protocol+"//"+r.host+r.pathname.substr(0,r.pathname.lastIndexOf("/")+1)};e.exports=n},function(e,t,r){function n(e){return a(e)||i(e)||o()}function o(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function i(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function a(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){u(e,t,r[t])})}return e}function u(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function h(e,t,r){return t&&f(e.prototype,t),r&&f(e,r),e}var p,d,y=r(0).Validator,m=r(4),v=r(5),g=r(7),b=g.pipe,w=g.validData,E=g.buildSearchFromData,_=g.setUtilRegression,S=r(3),T=S.TypeError,O=S.InternalArrayTypeError,A=S.InstanceTypeError,k=S.MissingFieldError,j=r(1),P=j.UserSchema,C=j.MediaSchema,x=j.RecoConstructorDataSchema,I=function(e){_(e),d=e},N=function(e){return e?{userId:!0,sessionId:!0,mediaId:!1,mediaType:!1,partnerID:!0,userAge:!1,excludeConsumedContent:!0,excludeProgramId:!1,includeProgramId:!1,includeMediaType:!1,includeCategoryIds:!1,includeContentType:!1,limit:!1,location:!1,layout:!0,recoType:!0}:{userId:!0,sessionId:!0,mediaId:!1,mediaType:!1,userAge:!1,excludeConsumedContent:!0,excludeProgramId:!1,includeProgramId:!1,includeMediaType:!1,includeCategoryIds:!1,includeContentType:!1,limit:!1,location:!1,layout:!0,recoType:!0}},R=function(){function e(t){if(l(this,e),!t)throw new Error("The object passed as parameter cannot be empty");var r=new y;r.addSchema(P,"/User"),r.addSchema(C,"/Media");var n=r.validate(t,x);if(!n.valid)throw new Error(n.errors);this.setUser(t.user),this.setMedia(t.media),t.partnerKey&&this.setPartnerKey(t.partnerKey),this.setExcludeConsumedContent(t.excludeConsumedContent),t.excludeProgramId&&this.setExcludeProgramId(t.excludeProgramId),t.includeProgramId&&this.setIncludeProgramId(t.includeProgramId),t.includeMediaType&&this.setIncludeMediaType(t.includeMediaType),t.includeCategoryIds&&this.setIncludeCategoryIds(t.includeCategoryIds),t.includeContentType&&this.setIncludeContentType(t.includeContentType),this.setLimit(t.limit),t.location&&this.setLocation(t.location),this.setLayout(t.layout),this.setRecoType(t.recoType)}return h(e,[{key:"setUser",value:function(e){if(!(e&&e instanceof m))throw new A("user","User");this.user=e}},{key:"setMedia",value:function(e){if(!(e&&e instanceof v))throw new A("media","Media");this.media=e}},{key:"setPartnerKey",value:function(e){if(!e||"string"!=typeof e)throw new T("partnerKey","string");this.partnerKey=e}},{key:"setExcludeConsumedContent",value:function(e){if(!e||"string"!=typeof e)throw new T("excludeConsumedContent","string");this.excludeConsumedContent=e}},{key:"setExcludeProgramId",value:function(e){this._isArrayOfString(e,"excludeProgramId"),this.excludeProgramId=e}},{key:"addExcludeProgramId",value:function(e){if("string"!=typeof e)throw new T("excludeProgramId","string");this.excludeProgramId||(this.excludeProgramId=[]),this.excludeProgramId.push(e)}},{key:"setIncludeProgramId",value:function(e){this._isArrayOfString(e,"includeProgramId"),e&&(this.includeProgramId=e)}},{key:"addIncludeProgramId",value:function(e){if("string"!=typeof e)throw new T("includeProgramId","string");this.includeProgramId||(this.includeProgramId=[]),this.includeProgramId.push(e)}},{key:"setIncludeMediaType",value:function(e){this._isArrayOfString(e,"includeMediaType"),e&&(this.includeMediaType=e)}},{key:"addIncludeMediaType",value:function(e){if("string"!=typeof e)throw new T("includeMediaType","string");this.includeMediaType||(this.includeMediaType=[]),this.includeMediaType.push(e)}},{key:"setIncludeContentType",value:function(e){this._isArrayOfString(e,"includeContentType"),e&&(this.includeContentType=e)}},{key:"addIncludeContentType",value:function(e){if("string"!=typeof e)throw new T("includeContentType","string");this.includeContentType||(this.includeContentType=[]),this.includeContentType.push(e)}},{key:"setIncludeCategoryIds",value:function(e){this._isArrayOfString(e,"includeCategoryIds"),e&&(this.includeCategoryIds=e)}},{key:"addIncludeCategoryIds",value:function(e){if("string"!=typeof e)throw new T("includeCategoryId","string");this.includeCategoryIds||(this.includeCategoryIds=[]),this.includeCategoryIds.push(e)}},{key:"setLimit",value:function(e){if(!e||isNaN(e)||"number"!=typeof e)throw new T("limit","number");this.limit=e}},{key:"setLocation",value:function(e){if(!e||"string"!=typeof e)throw new T("location","string");this.location=e}},{key:"setLayout",value:function(e){if(!e||"string"!=typeof e)throw new T("layout","string");this.layout=e}},{key:"setRecoType",value:function(e){if(!e||"string"!=typeof e)throw new T("recoType","string");this.recoType=e}},{key:"getUser",value:function(){return this.user}},{key:"getPartnerKey",value:function(){return this.partnerKey}},{key:"getMedia",value:function(){return this.media}},{key:"getExcludeConsumedContent",value:function(){return this.excludeConsumedContent}},{key:"getExcludeProgramId",value:function(){return this.excludeProgramId}},{key:"getIncludeProgramId",value:function(){return this.includeProgramId}},{key:"getIncludeMediaType",value:function(){return this.includeMediaType}},{key:"getIncludeContentType",value:function(){return this.includeContentType}},{key:"getIncludeCategoryIds",value:function(){return this.includeCategoryIds}},{key:"getLimit",value:function(){return this.limit}},{key:"getLocation",value:function(){return this.location}},{key:"getLayout",value:function(){return this.layout}},{key:"getRecoType",value:function(){return this.recoType}},{key:"getUrl",value:function(){return"https://reco.prd.bda.rtbf.be"+"".concat(d?"/recommendations/v1.0/api":"/api/v".concat("2.0","/recommendations"))+b(w(N(d)),E)(this.getData())}},{key:"sendRequest",value:function(){var e,t={timeout:5e3};switch(!0){case 1===arguments.length:if("function"!=typeof(arguments.length<=0?void 0:arguments[0]))throw new k("callback(error, success)");e=arguments.length<=0?void 0:arguments[0];break;case 2===arguments.length:if("object"!==c(arguments.length<=0?void 0:arguments[0]))throw new T("option","{key: value} object");if("function"!=typeof(arguments.length<=1?void 0:arguments[1]))throw new k("callback(error, success)");e=arguments.length<=1?void 0:arguments[1],t=s({},t,arguments.length<=0?void 0:arguments[0]);break;default:throw new Error("at least one arg should be pass")}try{var r=b(w(N(d)),E)(this.getData());t.regression=d,p("".concat(d?"/recommendations/v1.0/api":"/api/v".concat("2.0","/recommendations")),r,t).then(function(e){return{queryId:d?e.queryId:e.query_id,recommendations:d?e.recommendations:e.recommendations.map(function(e){return{mediaId:e.id,mediaType:e.type,similarity:e.similarity}})}}).then(function(t){e(null,t)}).catch(function(t){e(t,null)})}catch(t){e(t,null)}}},{key:"getData",value:function(){var e=n(this.getUser().toArray()).concat(n(this.getMedia().toArray()),[{key:"excludeConsumedContent",value:this.getExcludeConsumedContent()},{key:"excludeProgramId",value:this.getExcludeProgramId()},{key:"includeProgramId",value:this.getIncludeProgramId()},{key:"includeMediaType",value:this.getIncludeMediaType()},{key:"includeCategoryIds",value:this.getIncludeCategoryIds()},{key:"includeContentType",value:this.getIncludeContentType()},{key:"limit",value:this.getLimit()},{key:"location",value:this.getLocation()},{key:"layout",value:this.getLayout()}]);return d?e.push({key:"partnerID",value:this.getPartnerKey()}):e.push({key:"recoType",value:this.getRecoType()}),e}},{key:"_isArrayOfString",value:function(e,t){if(!e||!Array.isArray(e)||"string"==typeof e)throw new T(t,"array");if(e.filter(function(e){return"string"!=typeof e}).length>0)throw new O("string")}}]),e}();e.exports={setRecoRegression:I,reco:function(e){if(!e||"function"!=typeof e)throw new T("pSender","function");return p=e,R}}},function(e,t,r){function n(e){return a(e)||i(e)||o()}function o(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function i(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function a(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){u(e,t,r[t])})}return e}function u(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function h(e,t,r){return t&&f(e.prototype,t),r&&f(e,r),e}var p,d=r(0).Validator,y=r(1),m=y.UserSchema,v=y.MediaSchema,g=y.ClickConstructorDataSchema,b=r(4),w=r(5),E=r(7),_=E.pipe,S=E.validData,T=E.buildSearchFromData,O=E.sendRequest,A=E.setUtilRegression,k=null,j=function(e){A(e),p=e},P=function(e){return e?{userId:!0,sessionId:!0,mediaId:!0,mediaType:!0,partnerID:!0,queryId:!0,layout:!0}:{userId:!0,sessionId:!0,mediaId:!0,mediaType:!0,queryId:!0,layout:!0}},C=function(){function e(t){if(l(this,e),!t)throw new Error("should pass 1 parameter");var r=new d;r.addSchema(m,"/User"),r.addSchema(v,"/Media");var n=r.validate(t,g);if(!n.valid)throw new Error(n.errors);this.setUser(t.user),this.setMedia(t.media),this.setPartnerKey(t.partnerKey),this.setQueryId(t.queryId),this.setLayout(t.layout)}return h(e,[{key:"setUser",value:function(e){if(!(e&&e instanceof b))throw new Error("user is not an instance of User");this.user=e}},{key:"setMedia",value:function(e){if(!(e&&e instanceof w))throw new Error("media is not an instance of Media");this.media=e}},{key:"setPartnerKey",value:function(e){if(!e||"string"!=typeof e)throw new Error("partnerKey is not a string");this.partnerKey=e}},{key:"setQueryId",value:function(e){if(!e||"string"!=typeof e)throw new Error("queryId is not a string");e&&(this.queryId=e)}},{key:"setLayout",value:function(e){if(!e||"string"!=typeof e)throw new Error("layout is not a string");e&&(this.layout=e)}},{key:"getUser",value:function(){return this.user}},{key:"getMedia",value:function(){return this.media}},{key:"getPartnerKey",value:function(){return this.partnerKey}},{key:"getQueryId",value:function(){return this.queryId}},{key:"getLayout",value:function(){return this.layout}},{key:"getUrl",value:function(){return p?"https://reco.prd.bda.rtbf.be/clicks/v1.0/api"+_(S(P(p)),T)(this.getData()):{url:"".concat("https://reco.prd.bda.rtbf.be","/api/v").concat("2.0","/clicks"),data:_(S(P(p)),function(e){return e.valid.reduce(function(e,t){return e[t.key]=t.value,e},{})})(this.getData())}}},{key:"sendRequest",value:function(){var e,t={timeout:5e3};switch(!0){case 1===arguments.length:if("function"!=typeof(arguments.length<=0?void 0:arguments[0]))throw new Error("callback not defined");e=arguments.length<=0?void 0:arguments[0];break;case 2===arguments.length:if("object"!==c(arguments.length<=0?void 0:arguments[0]))throw new Error("option not an object");if("function"!=typeof(arguments.length<=1?void 0:arguments[1]))throw new Error("callback is not defined");e=arguments.length<=1?void 0:arguments[1],t=s({},t,arguments.length<=0?void 0:arguments[0]);break;default:throw new Error("at least one arg should be pass")}try{var r=_(S(P(p)),function(e){return e.valid.reduce(function(e,t){return e[t.key.replace(/\.?([A-Z])/g,function(e,t){return"_"+t.toLowerCase()}).replace(/^_/,"")]=t.value,e},{})})(this.getData());t.path="/api/v".concat("2.0","/clicks"),(p?O(t,"/clicks/v1.0/api",_(S(P(p)),T)(this.getData())):k("click",r,t)).then(function(t){e(null,t)}).catch(function(t){e(t,null)})}catch(t){e(t,null)}}},{key:"getData",value:function(){var e=n(this.getMedia().toArray()).concat([{key:"userId",value:this.getUser().getUserId()},{key:"sessionId",value:this.getUser().getSessionId()},{key:"queryId",value:this.getQueryId()},{key:"layout",value:this.getLayout()}]);return p&&e.push({key:"partnerID",value:this.getPartnerKey()}),e}}]),e}();e.exports={setClickRegression:j,click:function(e){if(!e)throw new Error("no sender defined");if("function"!=typeof e)throw new Error("pSender is not a function");return k=e,C}}},function(e,t,r){function n(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){p(e,t,r[t])})}return e}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t,r){return t&&a(e.prototype,t),r&&a(e,r),e}function u(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?c(e):t}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function p(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var d,y=r(0).Validator,m=r(4),v=r(5),g=r(6),b=r(3),w=b.TypeError,E=r(7),_=E.pipe,S=E.validData,T=r(1),O=T.UserSchema,A=T.FeedbackConstructorDataSchema,k=(d={},p(d,"click",{layout:!0,media:v,queryId:!0}),p(d,"favorite",{}),p(d,"like",{}),p(d,"viewed",{queryId:!0,layout:!0,medias:[v]}),d),j=null,P=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(i(this,t),!r)throw new Error("The object passed as parameter cannot be empty");var n=new y;n.addSchema(O,"/User");var o=n.validate(r,A);if(!o.valid)throw new Error(o.errors);return e=u(this,l(t).call(this)),e.setAction(r.action),e.setUser(r.user),e}return f(t,e),s(t,[{key:"setAction",value:function(e){if(!e||"string"!=typeof e)throw new Error("action is not a string");var t=Object.keys(k).reduce(function(e,t){return e+", '"+t+"'"},"").replace(/^, /,"");if(-1===Object.keys(k).indexOf(e))throw new Error("Action: ".concat(e,", not exist. You can only send feedback for ").concat(t));this.action=e}},{key:"setUser",value:function(e){if(!(e&&e instanceof m))throw new Error("the user is not an instance of User");this.user=e}},{key:"send",value:function(e){if(!e||"object"!==o(e))throw new w("data","object");if(0===Object.keys(e).length)throw new Error("There is no data in the object data to send");var t=_(function(e){return Object.keys(e).map(function(t){return{key:t,value:e[t]}})},S(k[this.action]),function(e){return{error:e.error,valid:e.valid.reduce(function(e,t){return e[t.key]=t.value,e},{})}})(e),r=t.error,i=t.valid;return r.length>0?this.emit("error",new Error("error during validation process: ".concat(r.reduce(function(e,t){return"".concat(e).concat(t.message,", ")},"").replace(/, $/,"")))):j(this.action,n({},i,{user:this.user,time:{navigation:Math.round(performance.now()/1e3)}}))}}]),t}(g);e.exports={feedback:function(e){if(!e)throw new Error("no sender defined");if("function"!=typeof e)throw new Error("pSender is not a function");return j=e,P}}},function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){i(e,t,r[t])})}return e}function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t,r){return t&&s(e.prototype,t),r&&s(e,r),e}function c(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?l(e):t}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=r(0).Validator,y=r(6),m=r(4),v=r(7),g=v.pipe,b=v.validData,w=r(3),E=w.TypeError,_=w.InstanceTypeError,S=r(1),T=S.UserSchema,O=S.MediaSchema,A=S.RecommendationConstructorDataSchema,k=S.RecommendationSendDataSchema,j={media:!1,excludeConsumedContent:!1,excludeProgramId:!1,includeProgramId:!1,includeMediaType:!1,includeCategoryIds:!1,includeContentType:!1,limit:!0,location:!1,layout:!0,recoType:!0},P=null,C=function(e){function t(e){var r;if(a(this,t),!e)throw new Error("The object passed as parameter cannot be empty");var n=new d;n.addSchema(T,"/User");var o=n.validate(e,A);if(!o.valid)throw new Error(o.errors);return r=c(this,f(t).call(this)),r.setUser(e.user),r}return h(t,e),u(t,[{key:"setUser",value:function(e){if(!(e&&e instanceof m))throw new _("user","User");this.user=e}},{key:"send",value:function(e){if(!e)throw new Error("The object passed as parameter cannot be empty");var t=new d;t.addSchema(O,"/Media");var r=t.validate(e,k);if(!r.valid)return this.emit("error",new Error(r.errors));var n=g(function(e){return Object.keys(e).map(function(t){return{key:t,value:e[t]}})},b(j),function(e){return{error:e.error,valid:e.valid.reduce(function(e,t){return e[t.key]=t.value,e},{})}})(e),i=n.valid;return P("recommendation",o({},i,{user:this.user,time:{navigation:Math.round(performance.now()/1e3)}}))}}]),t}(y);e.exports={recommendation:function(e){if(!e||"function"!=typeof e)throw new E("pSender","function");return P=e,C}}},function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e){return s(e)||a(e)||i()}function i(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function a(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function s(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t,r){return t&&c(e.prototype,t),r&&c(e,r),e}function f(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?h(e):t}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}r(17).shim();var m=r(0).Validator,v=r(28),g=r(5),b=r(3),w=b.TypeError,E=r(1),_=E.UserSchema,S=E.FeedbackSchema,T=E.ViewedScrollConstructorDataSchema,O=null,A=function(e){for(var t=e.offsetTop,r=e.offsetLeft,n=e.offsetWidth,o=e.offsetHeight;e.offsetParent;)e=e.offsetParent,t+=e.offsetTop,r+=e.offsetLeft;return t<window.pageYOffset+window.innerHeight&&r<window.pageXOffset+window.innerWidth&&t+o>window.pageYOffset&&r+n>window.pageXOffset},k=function(e){function t(e){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(u(this,t),!e)throw new Error("The object passed as parameter cannot be empty");var o=new m;o.addSchema(S,"/Feedback"),o.addSchema(_,"/User");var i=o.validate(e,T);if(!i.valid)throw new Error(i.errors);var a=e.data,s=a.selector,c=a.layout,l=a.queryId,h=e.feedback;return r=f(this,p(t).call(this,{feedback:h,layout:c},n)),r._setSelector(s),r._setQueryId(l),r._init(),r}return d(t,e),l(t,[{key:"_init",value:function(){var e=this;this.sendMedia(),window.addEventListener("scroll",function(){null!==O&&clearTimeout(O),O=setTimeout(function(){e.sendMedia()},e.secondBeforeSend)},!1)}},{key:"_setSelector",value:function(e){if(!e||0===e.length||"string"!=typeof e)throw new w("selector","string");this.selector=e}},{key:"_setQueryId",value:function(e){if(!e||0===e.length||"string"!=typeof e)throw new w("queryId","string");this.queryId=e}},{key:"sendMedia",value:function(){var e=this,t=o(document.querySelectorAll(this.selector)).map(function(e){return{media:new g({mediaId:e.dataset.id,mediaType:e.dataset.mediatype}),visible:A(e)}}),r=t.filter(function(t){var r=t.media;return!!t.visible&&!e.mediasSent.find(function(e){var t=e.mediaId,n=e.mediaType;return r.mediaId===t&&r.mediaType===n})});r.length>0&&(this.feedback.send({medias:r.map(function(e){return e.media}),queryId:this.queryId,layout:this.layout}).receive("ok",function(e){}).receive("error",function(e){}),r.forEach(function(t){var r=t.media;return e.mediasSent.push(r)}))}}]),t}(v);e.exports={viewedScroll:function(){return k}}},function(e,t,r){"use strict";var n=Object.prototype.hasOwnProperty,o=Object.prototype.toString,i=Array.prototype.slice,a=r(58),s=Object.prototype.propertyIsEnumerable,u=!s.call({toString:null},"toString"),c=s.call(function(){},"prototype"),l=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],f=function(e){var t=e.constructor;return t&&t.prototype===e},h={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},p=function(){if("undefined"==typeof window)return!1;for(var e in window)try{if(!h["$"+e]&&n.call(window,e)&&null!==window[e]&&"object"==typeof window[e])try{f(window[e])}catch(e){return!0}}catch(e){return!0}return!1}(),d=function(e){if("undefined"==typeof window||!p)return f(e);try{return f(e)}catch(e){return!1}},y=function(e){var t=null!==e&&"object"==typeof e,r="[object Function]"===o.call(e),i=a(e),s=t&&"[object String]"===o.call(e),f=[];if(!t&&!r&&!i)throw new TypeError("Object.keys called on a non-object");var h=c&&r;if(s&&e.length>0&&!n.call(e,0))for(var p=0;p<e.length;++p)f.push(String(p));if(i&&e.length>0)for(var y=0;y<e.length;++y)f.push(String(y));else for(var m in e)h&&"prototype"===m||!n.call(e,m)||f.push(String(m));if(u)for(var v=d(e),g=0;g<l.length;++g)v&&"constructor"===l[g]||!n.call(e,l[g])||f.push(l[g]);return f};y.shim=function(){if(Object.keys){if(!function(){return 2===(Object.keys(arguments)||"").length}(1,2)){var e=Object.keys;Object.keys=function(t){return e(a(t)?i.call(t):t)}}}else Object.keys=y;return Object.keys||y},e.exports=y},function(e,t,r){"use strict";var n=Object.prototype.toString;e.exports=function(e){var t=n.call(e),r="[object Arguments]"===t;return r||(r="[object Array]"!==t&&null!==e&&"object"==typeof e&&"number"==typeof e.length&&e.length>=0&&"[object Function]"===n.call(e.callee)),r}},function(e,t,r){"use strict";var n=r(11),o=r(61),i=r(21),a=i("%TypeError%"),s=i("%SyntaxError%"),u=i("%Array%"),c=i("%String%"),l=i("%Object%"),f=i("%Number%"),h=i("%Symbol%",!0),p=i("%RegExp%"),d=!!h,y=r(22),m=r(23),v=f.MAX_SAFE_INTEGER||Math.pow(2,53)-1,g=r(67),b=r(24),w=r(25),E=r(68),_=parseInt,S=r(12),T=S.call(Function.call,u.prototype.slice),O=S.call(Function.call,c.prototype.slice),A=S.call(Function.call,p.prototype.test,/^0b[01]+$/i),k=S.call(Function.call,p.prototype.test,/^0o[0-7]+$/i),j=S.call(Function.call,p.prototype.exec),P=["","​","￾"].join(""),C=new p("["+P+"]","g"),x=S.call(Function.call,p.prototype.test,C),I=/^[-+]0x[0-9a-f]+$/i,N=S.call(Function.call,p.prototype.test,I),R=S.call(Function.call,c.prototype.charCodeAt),D=S.call(Function.call,Object.prototype.toString),M=Math.floor,$=Math.abs,L=Object.create,U=l.getOwnPropertyDescriptor,F=l.isExtensible,q=["\t\n\v\f\r   ᠎    ","         　\u2028","\u2029\ufeff"].join(""),B=new RegExp("(^["+q+"]+)|(["+q+"]+$)","g"),H=S.call(Function.call,c.prototype.replace),G=function(e){return H(e,B,"")},V=r(69),K=r(71),z=g(g({},V),{Call:function(e,t){var r=arguments.length>2?arguments[2]:[];if(!this.IsCallable(e))throw new a(e+" is not a function");return e.apply(t,r)},ToPrimitive:o,ToNumber:function(e){var t=E(e)?e:o(e,f);if("symbol"==typeof t)throw new a("Cannot convert a Symbol value to a number");if("string"==typeof t){if(A(t))return this.ToNumber(_(O(t,2),2));if(k(t))return this.ToNumber(_(O(t,2),8));if(x(t)||N(t))return NaN;var r=G(t);if(r!==t)return this.ToNumber(r)}return f(t)},ToInt16:function(e){var t=this.ToUint16(e);return t>=32768?t-65536:t},ToInt8:function(e){var t=this.ToUint8(e);return t>=128?t-256:t},ToUint8:function(e){var t=this.ToNumber(e);if(y(t)||0===t||!m(t))return 0;var r=b(t)*M($(t));return w(r,256)},ToUint8Clamp:function(e){var t=this.ToNumber(e);if(y(t)||t<=0)return 0;if(t>=255)return 255;var r=M(e);return r+.5<t?r+1:t<r+.5?r:r%2!=0?r+1:r},ToString:function(e){if("symbol"==typeof e)throw new a("Cannot convert a Symbol value to a string");return c(e)},ToObject:function(e){return this.RequireObjectCoercible(e),l(e)},ToPropertyKey:function(e){var t=this.ToPrimitive(e,c);return"symbol"==typeof t?t:this.ToString(t)},ToLength:function(e){var t=this.ToInteger(e);return t<=0?0:t>v?v:t},CanonicalNumericIndexString:function(e){if("[object String]"!==D(e))throw new a("must be a string");if("-0"===e)return-0;var t=this.ToNumber(e);return this.SameValue(this.ToString(t),e)?t:void 0},RequireObjectCoercible:V.CheckObjectCoercible,IsArray:u.isArray||function(e){return"[object Array]"===D(e)},IsConstructor:function(e){return"function"==typeof e&&!!e.prototype},IsExtensible:Object.preventExtensions?function(e){return!E(e)&&F(e)}:function(e){return!0},IsInteger:function(e){if("number"!=typeof e||y(e)||!m(e))return!1;var t=$(e);return M(t)===t},IsPropertyKey:function(e){return"string"==typeof e||"symbol"==typeof e},IsRegExp:function(e){if(!e||"object"!=typeof e)return!1;if(d){var t=e[h.match];if(void 0!==t)return V.ToBoolean(t)}return K(e)},SameValueZero:function(e,t){return e===t||y(e)&&y(t)},GetV:function(e,t){if(!this.IsPropertyKey(t))throw new a("Assertion failed: IsPropertyKey(P) is not true");return this.ToObject(e)[t]},GetMethod:function(e,t){if(!this.IsPropertyKey(t))throw new a("Assertion failed: IsPropertyKey(P) is not true");var r=this.GetV(e,t);if(null!=r){if(!this.IsCallable(r))throw new a(t+"is not a function");return r}},Get:function(e,t){if("Object"!==this.Type(e))throw new a("Assertion failed: Type(O) is not Object");if(!this.IsPropertyKey(t))throw new a("Assertion failed: IsPropertyKey(P) is not true");return e[t]},Type:function(e){return"symbol"==typeof e?"Symbol":V.Type(e)},SpeciesConstructor:function(e,t){if("Object"!==this.Type(e))throw new a("Assertion failed: Type(O) is not Object");var r=e.constructor;if(void 0===r)return t;if("Object"!==this.Type(r))throw new a("O.constructor is not an Object");var n=d&&h.species?r[h.species]:void 0;if(null==n)return t;if(this.IsConstructor(n))return n;throw new a("no constructor found")},CompletePropertyDescriptor:function(e){if(!this.IsPropertyDescriptor(e))throw new a("Desc must be a Property Descriptor");return this.IsGenericDescriptor(e)||this.IsDataDescriptor(e)?(n(e,"[[Value]]")||(e["[[Value]]"]=void 0),n(e,"[[Writable]]")||(e["[[Writable]]"]=!1)):(n(e,"[[Get]]")||(e["[[Get]]"]=void 0),n(e,"[[Set]]")||(e["[[Set]]"]=void 0)),n(e,"[[Enumerable]]")||(e["[[Enumerable]]"]=!1),n(e,"[[Configurable]]")||(e["[[Configurable]]"]=!1),e},Set:function(e,t,r,n){if("Object"!==this.Type(e))throw new a("O must be an Object");if(!this.IsPropertyKey(t))throw new a("P must be a Property Key");if("Boolean"!==this.Type(n))throw new a("Throw must be a Boolean");if(n)return e[t]=r,!0;try{e[t]=r}catch(e){return!1}},HasOwnProperty:function(e,t){if("Object"!==this.Type(e))throw new a("O must be an Object");if(!this.IsPropertyKey(t))throw new a("P must be a Property Key");return n(e,t)},HasProperty:function(e,t){if("Object"!==this.Type(e))throw new a("O must be an Object");if(!this.IsPropertyKey(t))throw new a("P must be a Property Key");return t in e},IsConcatSpreadable:function(e){if("Object"!==this.Type(e))return!1;if(d&&"symbol"==typeof h.isConcatSpreadable){var t=this.Get(e,Symbol.isConcatSpreadable);if(void 0!==t)return this.ToBoolean(t)}return this.IsArray(e)},Invoke:function(e,t){if(!this.IsPropertyKey(t))throw new a("P must be a Property Key");var r=T(arguments,2),n=this.GetV(e,t);return this.Call(n,e,r)},GetIterator:function(e,t){if(!d)throw new SyntaxError("ES.GetIterator depends on native iterator support.");var r=t;arguments.length<2&&(r=this.GetMethod(e,h.iterator));var n=this.Call(r,e);if("Object"!==this.Type(n))throw new a("iterator must return an object");return n},IteratorNext:function(e,t){var r=this.Invoke(e,"next",arguments.length<2?[]:[t]);if("Object"!==this.Type(r))throw new a("iterator next must return an object");return r},IteratorComplete:function(e){if("Object"!==this.Type(e))throw new a("Assertion failed: Type(iterResult) is not Object");return this.ToBoolean(this.Get(e,"done"))},IteratorValue:function(e){if("Object"!==this.Type(e))throw new a("Assertion failed: Type(iterResult) is not Object");return this.Get(e,"value")},IteratorStep:function(e){var t=this.IteratorNext(e);return!0!==this.IteratorComplete(t)&&t},IteratorClose:function(e,t){if("Object"!==this.Type(e))throw new a("Assertion failed: Type(iterator) is not Object");if(!this.IsCallable(t))throw new a("Assertion failed: completion is not a thunk for a Completion Record");var r=t,n=this.GetMethod(e,"return");if(void 0===n)return r();var o;try{var i=this.Call(n,e,[])}catch(e){throw o=r(),r=null,e}if(o=r(),r=null,"Object"!==this.Type(i))throw new a("iterator .return must return an object");return o},CreateIterResultObject:function(e,t){if("Boolean"!==this.Type(t))throw new a("Assertion failed: Type(done) is not Boolean");return{value:e,done:t}},RegExpExec:function(e,t){if("Object"!==this.Type(e))throw new a("R must be an Object");if("String"!==this.Type(t))throw new a("S must be a String");var r=this.Get(e,"exec");if(this.IsCallable(r)){var n=this.Call(r,e,[t]);if(null===n||"Object"===this.Type(n))return n;throw new a('"exec" method must return `null` or an Object')}return j(e,t)},ArraySpeciesCreate:function(e,t){if(!this.IsInteger(t)||t<0)throw new a("Assertion failed: length must be an integer >= 0");var r,n=0===t?0:t;if(this.IsArray(e)&&(r=this.Get(e,"constructor"),"Object"===this.Type(r)&&d&&h.species&&null===(r=this.Get(r,h.species))&&(r=void 0)),void 0===r)return u(n);if(!this.IsConstructor(r))throw new a("C must be a constructor");return new r(n)},CreateDataProperty:function(e,t,r){if("Object"!==this.Type(e))throw new a("Assertion failed: Type(O) is not Object");if(!this.IsPropertyKey(t))throw new a("Assertion failed: IsPropertyKey(P) is not true");var n=U(e,t),o=n||"function"!=typeof F||F(e);if(n&&(!n.writable||!n.configurable)||!o)return!1;var i={configurable:!0,enumerable:!0,value:r,writable:!0};return Object.defineProperty(e,t,i),!0},CreateDataPropertyOrThrow:function(e,t,r){if("Object"!==this.Type(e))throw new a("Assertion failed: Type(O) is not Object");if(!this.IsPropertyKey(t))throw new a("Assertion failed: IsPropertyKey(P) is not true");var n=this.CreateDataProperty(e,t,r);if(!n)throw new a("unable to create data property");return n},ObjectCreate:function(e,t){if(null!==e&&"Object"!==this.Type(e))throw new a("Assertion failed: proto must be null or an object");if((arguments.length<2?[]:t).length>0)throw new s("es-abstract does not yet support internal slots");if(null===e&&!L)throw new s("native Object.create support is required to create null objects");return L(e)},AdvanceStringIndex:function(e,t,r){if("String"!==this.Type(e))throw new a("S must be a String");if(!this.IsInteger(t)||t<0||t>v)throw new a("Assertion failed: length must be an integer >= 0 and <= 2**53");if("Boolean"!==this.Type(r))throw new a("Assertion failed: unicode must be a Boolean");if(!r)return t+1;if(t+1>=e.length)return t+1;var n=R(e,t);if(n<55296||n>56319)return t+1;var o=R(e,t+1);return o<56320||o>57343?t+1:t+2}});delete z.CheckObjectCoercible,e.exports=z},function(e,t,r){"use strict";var n=Array.prototype.slice,o=Object.prototype.toString;e.exports=function(e){var t=this;if("function"!=typeof t||"[object Function]"!==o.call(t))throw new TypeError("Function.prototype.bind called on incompatible "+t);for(var r,i=n.call(arguments,1),a=function(){if(this instanceof r){var o=t.apply(this,i.concat(n.call(arguments)));return Object(o)===o?o:this}return t.apply(e,i.concat(n.call(arguments)))},s=Math.max(0,t.length-i.length),u=[],c=0;c<s;c++)u.push("$"+c);if(r=Function("binder","return function ("+u.join(",")+"){ return binder.apply(this,arguments); }")(a),t.prototype){var l=function(){};l.prototype=t.prototype,r.prototype=new l,l.prototype=null}return r}},function(e,t,r){"use strict";e.exports=r(62)},function(e,t,r){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator,o=r(20),i=r(13),a=r(63),s=r(64),u=function(e,t){if(void 0===e||null===e)throw new TypeError("Cannot call method on "+e);if("string"!=typeof t||"number"!==t&&"string"!==t)throw new TypeError('hint must be "string" or "number"');var r,n,a,s="string"===t?["toString","valueOf"]:["valueOf","toString"];for(a=0;a<s.length;++a)if(r=e[s[a]],i(r)&&(n=r.call(e),o(n)))return n;throw new TypeError("No default value")},c=function(e,t){var r=e[t];if(null!==r&&void 0!==r){if(!i(r))throw new TypeError(r+" returned for property "+t+" of object "+e+" is not a function");return r}};e.exports=function(e){if(o(e))return e;var t="default";arguments.length>1&&(arguments[1]===String?t="string":arguments[1]===Number&&(t="number"));var r;if(n&&(Symbol.toPrimitive?r=c(e,Symbol.toPrimitive):s(e)&&(r=Symbol.prototype.valueOf)),void 0!==r){var i=r.call(e,t);if(o(i))return i;throw new TypeError("unable to convert exotic object to primitive")}return"default"===t&&(a(e)||s(e))&&(t="string"),u(e,"default"===t?"number":t)}},function(e,t,r){"use strict";var n=Date.prototype.getDay,o=function(e){try{return n.call(e),!0}catch(e){return!1}},i=Object.prototype.toString,a="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag;e.exports=function(e){return"object"==typeof e&&null!==e&&(a?o(e):"[object Date]"===i.call(e))}},function(e,t,r){"use strict";var n=Object.prototype.toString;if(r(65)()){var o=Symbol.prototype.toString,i=/^Symbol\(.*\)$/,a=function(e){return"symbol"==typeof e.valueOf()&&i.test(o.call(e))};e.exports=function(e){if("symbol"==typeof e)return!0;if("[object Symbol]"!==n.call(e))return!1;try{return a(e)}catch(e){return!1}}}else e.exports=function(e){return!1}},function(e,t,r){"use strict";(function(t){var n=t.Symbol,o=r(66);e.exports=function(){return"function"==typeof n&&"function"==typeof Symbol&&"symbol"==typeof n("foo")&&"symbol"==typeof Symbol("bar")&&o()}}).call(t,r(8))},function(e,t,r){"use strict";e.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),r=Object(t);if("string"==typeof t)return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(r))return!1;e[t]=42;for(t in e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var n=Object.getOwnPropertySymbols(e);if(1!==n.length||n[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var o=Object.getOwnPropertyDescriptor(e,t);if(42!==o.value||!0!==o.enumerable)return!1}return!0}},function(e,t,r){var n=r(12),o=n.call(Function.call,Object.prototype.hasOwnProperty),i=Object.assign;e.exports=function(e,t){if(i)return i(e,t);for(var r in t)o(t,r)&&(e[r]=t[r]);return e}},function(e,t){e.exports=function(e){return null===e||"function"!=typeof e&&"object"!=typeof e}},function(e,t,r){"use strict";var n=r(21),o=n("%Object%"),i=n("%TypeError%"),a=n("%String%"),s=r(22),u=r(23),c=r(24),l=r(25),f=r(13),h=r(70),p=r(11),d={ToPrimitive:h,ToBoolean:function(e){return!!e},ToNumber:function(e){return+e},ToInteger:function(e){var t=this.ToNumber(e);return s(t)?0:0!==t&&u(t)?c(t)*Math.floor(Math.abs(t)):t},ToInt32:function(e){return this.ToNumber(e)>>0},ToUint32:function(e){return this.ToNumber(e)>>>0},ToUint16:function(e){var t=this.ToNumber(e);if(s(t)||0===t||!u(t))return 0;var r=c(t)*Math.floor(Math.abs(t));return l(r,65536)},ToString:function(e){return a(e)},ToObject:function(e){return this.CheckObjectCoercible(e),o(e)},CheckObjectCoercible:function(e,t){if(null==e)throw new i(t||"Cannot call method on "+e);return e},IsCallable:f,SameValue:function(e,t){return e===t?0!==e||1/e==1/t:s(e)&&s(t)},Type:function(e){return null===e?"Null":void 0===e?"Undefined":"function"==typeof e||"object"==typeof e?"Object":"number"==typeof e?"Number":"boolean"==typeof e?"Boolean":"string"==typeof e?"String":void 0},IsPropertyDescriptor:function(e){if("Object"!==this.Type(e))return!1;var t={"[[Configurable]]":!0,"[[Enumerable]]":!0,"[[Get]]":!0,"[[Set]]":!0,"[[Value]]":!0,"[[Writable]]":!0};for(var r in e)if(p(e,r)&&!t[r])return!1;var n=p(e,"[[Value]]"),o=p(e,"[[Get]]")||p(e,"[[Set]]");if(n&&o)throw new i("Property Descriptors may not be both accessor and data descriptors");return!0},IsAccessorDescriptor:function(e){if(void 0===e)return!1;if(!this.IsPropertyDescriptor(e))throw new i("Desc must be a Property Descriptor");return!(!p(e,"[[Get]]")&&!p(e,"[[Set]]"))},IsDataDescriptor:function(e){if(void 0===e)return!1;if(!this.IsPropertyDescriptor(e))throw new i("Desc must be a Property Descriptor");return!(!p(e,"[[Value]]")&&!p(e,"[[Writable]]"))},IsGenericDescriptor:function(e){if(void 0===e)return!1;if(!this.IsPropertyDescriptor(e))throw new i("Desc must be a Property Descriptor");return!this.IsAccessorDescriptor(e)&&!this.IsDataDescriptor(e)},FromPropertyDescriptor:function(e){if(void 0===e)return e;if(!this.IsPropertyDescriptor(e))throw new i("Desc must be a Property Descriptor");if(this.IsDataDescriptor(e))return{value:e["[[Value]]"],writable:!!e["[[Writable]]"],enumerable:!!e["[[Enumerable]]"],configurable:!!e["[[Configurable]]"]};if(this.IsAccessorDescriptor(e))return{get:e["[[Get]]"],set:e["[[Set]]"],enumerable:!!e["[[Enumerable]]"],configurable:!!e["[[Configurable]]"]};throw new i("FromPropertyDescriptor must be called with a fully populated Property Descriptor")},ToPropertyDescriptor:function(e){if("Object"!==this.Type(e))throw new i("ToPropertyDescriptor requires an object");var t={};if(p(e,"enumerable")&&(t["[[Enumerable]]"]=this.ToBoolean(e.enumerable)),p(e,"configurable")&&(t["[[Configurable]]"]=this.ToBoolean(e.configurable)),p(e,"value")&&(t["[[Value]]"]=e.value),p(e,"writable")&&(t["[[Writable]]"]=this.ToBoolean(e.writable)),p(e,"get")){var r=e.get;if(void 0!==r&&!this.IsCallable(r))throw new TypeError("getter must be a function");t["[[Get]]"]=r}if(p(e,"set")){var n=e.set;if(void 0!==n&&!this.IsCallable(n))throw new i("setter must be a function");t["[[Set]]"]=n}if((p(t,"[[Get]]")||p(t,"[[Set]]"))&&(p(t,"[[Value]]")||p(t,"[[Writable]]")))throw new i("Invalid property descriptor. Cannot both specify accessors and a value or writable attribute");return t}};e.exports=d},function(e,t,r){"use strict";var n=Object.prototype.toString,o=r(20),i=r(13),a={"[[DefaultValue]]":function(e){var t;if((t=arguments.length>1?arguments[1]:"[object Date]"===n.call(e)?String:Number)===String||t===Number){var r,a,s=t===String?["toString","valueOf"]:["valueOf","toString"];for(a=0;a<s.length;++a)if(i(e[s[a]])&&(r=e[s[a]](),o(r)))return r;throw new TypeError("No default value")}throw new TypeError("invalid [[DefaultValue]] hint supplied")}};e.exports=function(e){return o(e)?e:arguments.length>1?a["[[DefaultValue]]"](e,arguments[1]):a["[[DefaultValue]]"](e)}},function(e,t,r){"use strict";var n=r(11),o=RegExp.prototype.exec,i=Object.getOwnPropertyDescriptor,a=function(e){try{var t=e.lastIndex;return e.lastIndex=0,o.call(e),!0}catch(e){return!1}finally{e.lastIndex=t}},s=Object.prototype.toString,u="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag;e.exports=function(e){if(!e||"object"!=typeof e)return!1;if(!u)return"[object RegExp]"===s.call(e);var t=i(e,"lastIndex");return!(!t||!n(t,"value"))&&a(e)}},function(e,t,r){"use strict";var n=r(18),o=r(27);e.exports=function(){var e=o();return n(Array.prototype,{find:e},{find:function(){return Array.prototype.find!==e}}),e}},function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}function s(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?u(e):t}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}r(17).shim();var h=r(0).Validator,p=r(28),d=r(1),y=d.UserSchema,m=d.FeedbackSchema,v=d.MediaSchema,g=d.ViewedRelatedConstructorDataSchema,b=d.ViewedRelatedOpenDataSchema,w=null,E=function(e){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(o(this,t),!e)throw new Error("The object passed as parameter cannot be empty");var n=new h;n.addSchema(y,"/UserSchema"),n.addSchema(m,"/FeedbackSchema");var i=n.validate(e,g);if(!i.valid)throw new Error(i.errors);var a=e.data.layout,u=e.feedback;return s(this,c(t).call(this,{feedback:u,layout:a},r))}return l(t,e),a(t,[{key:"open",value:function(e){var t=this;if(!e)throw new Error("The object passed as parameter cannot be empty");var r=new h;r.addSchema(v,"/Media");var n=r.validate(e,b);if(!n.valid)throw new Error(n.errors);var o=e.medias,i=e.queryId,a=e.method;return w=setTimeout(function(){var e=o.filter(function(e){return!t.mediasSent.find(function(t){var r=t.mediaId,n=t.mediaType;return e.mediaId===r&&e.mediaType===n})});e.length>0&&(t.feedback.send({medias:e,queryId:i,layout:t.layout+":"+a}).receive("ok",function(e){}).receive("error",function(e){}),e.forEach(function(e){return t.mediasSent.push(e)}))},this.secondBeforeSend),this}},{key:"close",value:function(){return clearTimeout(w),this}}]),t}(p);e.exports={viewedRelated:function(){return E}}}]);